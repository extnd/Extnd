Ext.grid.RowSelectionModel.override({handleDDRowClick:function(a,d,c){if(c.button===0&&!c.shiftKey&&!c.ctrlKey){var b;b=(this.id=="checker"&&!this.singleSelect)?true:false;this.selectRow(d,b);a.view.focusRow(d)}},initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("rowmousedown",this.handleMouseDown,this)}else{this.grid.on("rowclick",this.handleDDRowClick,this)}this.rowNav=new Ext.KeyNav(this.grid.getGridEl(),{up:function(c){if(!c.shiftKey){this.selectPrevious(c.shiftKey)}else{if(this.last!==false&&this.lastActive!==false){var b=this.last;this.selectRange(this.last,this.lastActive-1);this.grid.getView().focusRow(this.lastActive);if(b!==false){this.last=b}}else{this.selectFirstRow()}}},down:function(c){if(!c.shiftKey){this.selectNext(c.shiftKey)}else{if(this.last!==false&&this.lastActive!==false){var b=this.last;this.selectRange(this.last,this.lastActive+1);this.grid.getView().focusRow(this.lastActive);if(b!==false){this.last=b}}else{this.selectFirstRow()}}},scope:this});var a=this.grid.view;a.on("refresh",this.onRefresh,this);a.on("rowupdated",this.onRowUpdated,this);a.on("rowremoved",this.onRemove,this)}});Ext.grid.CheckboxSelectionModel.override({handleDDRowClick:function(b,d,c){var a=Ext.lib.Event.getTarget(c);if(a.className!="x-grid3-row-checker"){Ext.grid.CheckboxSelectionModel.superclass.handleDDRowClick.apply(this,arguments)}}});Ext.grid.GridDragZone.override({getDragData:function(b){var a=Ext.lib.Event.getTarget(b);var d=this.view.findRowIndex(a);if(d!==false){var c=this.grid.selModel;if(c.id=="checker"&&c.checkOnly&&a.className!="x-grid3-row-checker"){}else{if((a.className!="x-grid3-row-checker")&&(!c.isSelected(d)||b.hasModifier())){if(c.id=="checker"&&!c.singleSelect){b.ctrlKey=true}c.handleMouseDown(this.grid,d,b)}}return{grid:this.grid,ddel:this.ddel,rowIndex:d,selections:c.getSelections()}}return false}});Ext.Toolbar.override({getUIView:function(){if(!this.uiView){if(this.ownerCt&&this.ownerCt.getXType()=="xnd-uiview"){this.uiView=this.ownerCt}else{this.uiView=null}}return this.uiView},getUIDocument:function(){if(!this.uiDocument){if(this.ownerCt&&this.ownerCt.getXType()=="xnd-uidocument"){this.uiDocument=this.ownerCt}else{this.uiDocument=null}}return this.uiDocument}});Ext.namespace("Ext.nd","Ext.nd.form","Ext.nd.data","Ext.nd.util");Ext.nd.version="1.0 RC1 for ExtJS 3.x";Ext.nd.getBlankImageUrl=function(){return this.extndUrl+"resources/images/s.gif"};Ext.nd.init=function(a){Ext.apply(this,a);Ext.BLANK_IMAGE_URL=this.getBlankImageUrl()};Ext.nd.util.addIFrame=function(c){var i;var j=false;var e=false;var b=false;var f=false;var k=c.documentLoadingWindowTitle||(c.uiDocument?c.uiDocument.documentLoadingWindowTitle:(c.uiView?c.uiView.documentLoadingWindowTitle:"Opening"));var h=c.documentUntitledWindowTitle||(c.uiDocument?c.uiDocument.documentUntitledWindowTitle:(c.uiView?c.uiView.documentUntitledWindowTitle:"(Untitled)"));var l=c.useDocumentWindowTitle||(c.uiDocument?c.uiDocument.useDocumentWindowTitle:(c.uiView?c.uiView.useDocumentWindowTitle:true));var g=c.documentWindowTitleMaxLength||(c.uiDocument?c.uiDocument.documentWindowTitleMaxLength:(c.uiView?c.uiView.documentWindowTitleMaxLength:16));var d=c.targetDefaults||(c.uiDocument?c.uiDocument.targetDefaults:(c.uiView?c.uiView.targetDefaults:{}));i=(c.target.getXType)?c.target:Ext.getCmp(c.target);i=(i&&i.getXType)?i:Ext.get(i);if(!i){window.open(c.url);return}if(i.add){j=i;if(j.items){b=j.items.get(c.id)}}else{e=Ext.get(i)}if(!b){var a="if-"+c.id;var m=Ext.apply({html:"<iframe id='"+a+"' src='"+c.url+"' frameBorder='0' width='100%' height='100%'/>",title:c.title||k,layout:"fit",id:c.id,closable:true},c.targetDefaults);if(j){if(j.getXType()=="window"){j.removeAll()}b=j.add(m);if(window==window.top){b.on("beforedestroy",function(o){if(typeof Ext!="undefined"){var n=Ext.DomQuery.selectNode("iframe",o.body.dom);if(n){if(n.src){n.src="javascript:false";Ext.removeNode(n)}}}})}b.on("afterrender",function(n){var p=Ext.DomQuery.selectNode("iframe",n.body.dom);var o=Ext.isIE?"onreadystatechange":"onload";p[o]=(function(){try{var s=this.contentWindow||window.frames[this.name];s.ownerCt=n;if(c.uiView){s.uiView=c.uiView}if(j){s.target=j}}catch(q){}if(l){try{var r=s.document.title;if(r!=""){if(g!=-1){n.setTitle(Ext.util.Format.ellipsis(r,g))}else{n.setTitle(r)}}else{if(n.title!=c.title&&c.title!=k){n.setTitle(h)}}}catch(q){if(n.title!=c.title&&n.title!=k){n.setTitle(h)}}}}).createDelegate(p)});if(j.doLayout){j.doLayout()}}else{if(e){b=new Ext.Panel(m)}}}if(b.show){b.show()}if(i.show){i.show()}};Ext.nd.util.doLayoutAndShow=function(a){if(a.ownerCt&&a.ownerCt.doLayout){a.ownerCt.doLayout()}if(a.show){a.show()}};Ext.nd.util.cleanUpConfig=function(a){if(typeof a.viewName=="string"){if(!a.dbPath&&Ext.nd.Session){a.dbPath=Ext.nd.Session.currentDatabase.webFilePath}if(!a.filePath&&Ext.nd.Session){a.filePath=Ext.nd.Session.currentDatabase.filePath}a.viewUrl=a.dbPath+a.viewName}else{if(a.viewUrl){var b=a.viewUrl.lastIndexOf("/")+1;a.dbPath=a.viewUrl.substring(0,b);a.viewName=a.viewUrl.substring(b)}}return a};Ext.nd.util.cleanUpUIViewConfig=function(a){if(typeof a.viewName=="string"){if(!a.dbPath&&Ext.nd.Session){a.dbPath=Ext.nd.Session.currentDatabase.webFilePath}if(!a.filePath&&Ext.nd.Session){a.filePath=Ext.nd.Session.currentDatabase.filePath}a.viewUrl=a.dbPath+a.viewName}else{if(a.viewUrl){var b=a.viewUrl.lastIndexOf("/")+1;a.dbPath=a.viewUrl.substring(0,b);a.viewName=a.viewUrl.substring(b)}}return a};Ext.nd.util.cleanUpUIOutlineConfig=function(a){if(typeof a.outlineName=="string"){if(!a.dbPath&&Ext.nd.Session){a.dbPath=Ext.nd.Session.currentDatabase.webFilePath}if(!a.filePath&&Ext.nd.Session){a.filePath=Ext.nd.Session.currentDatabase.filePath}a.outlineUrl=a.dbPath+a.outlineName}else{if(a.outlineUrl){var b=a.outlineUrl.lastIndexOf("/")+1;a.dbPath=a.outlineUrl.substring(0,b);a.outlineName=a.outlineUrl.substring(b)}}return a};Ext.nd.Formula=function(){return{evaluate:function(c){var o=c.callback;var p=Ext.nd.Session;var q=p.currentDatabase;var i=c.dbPath||q.webFilePath;var f=false;var k=c.target||null;var a=Ext.nd.extndUrl+"Evaluate?OpenAgent";var l=c.formula||c.macro;var j=c.outputformat||"json";var h=c.unid||"";var e={formula:l,db:i,unid:h,outputformat:j};var m={method:"POST",params:e,scope:this,evaluateCallback:o,success:d,failure:g,url:a};if(c.target!=null){var b=Ext.get(k);var n=b.getUpdateManager();n.update(m)}else{Ext.Ajax.request(m)}function d(t,u){var r=(u.evaluateCallback)?u.evaluateCallback:false;if(r){var s=u.params.outputformat;if(s=="json"){r(Ext.decode(t.responseText),t,u)}else{r(u.responseXML,t,u)}}}function g(r,s){}}}}();Ext.nd.data.ViewDesign=function(a){a=Ext.nd.util.cleanUpConfig(a);this.sess=Ext.nd.Session;this.dbPath=this.sess.currentDatabase.webFilePath;this.noteType="view";this.viewName="";this.multiExpand=false;this.storeConfig={};this.baseParams={};this.removeCategoryTotal=true;this.isCategorized=false;this.callback=Ext.emptyFn;Ext.apply(this,a);if(!this.viewUrl){this.viewUrl=this.dbPath+this.viewName}Ext.nd.data.ViewDesign.superclass.constructor.call(this);this.getViewDesign()};Ext.extend(Ext.nd.data.ViewDesign,Ext.util.Observable,{getViewDesign:function(){Ext.Ajax.request({method:"GET",disableCaching:true,success:this.getViewDesignStep2,failure:this.getViewDesignFailure,scope:this,url:this.viewUrl+"?ReadDesign"})},getViewDesignStep2:function(c,d){var a=c.responseXML;var e=Ext.DomQuery;var b=e.select("column",a);this.visibleCols=new Ext.util.MixedCollection();Ext.each(b,function(i,f,h){var g=Ext.DomQuery.selectValue("@name",i);if(typeof g!="undefined"){g=g.replace(/^$/,"_");this.visibleCols.add(g)}},this);Ext.Ajax.request({method:"GET",disableCaching:true,success:this.getViewDesignSuccess,failure:this.getViewDesignFailure,scope:this,url:Ext.nd.extndUrl+"DXLExporter?OpenAgent&db="+this.dbPath+"&type="+this.noteType+"&name="+this.viewName})},getViewDesignSuccess:function(G,L){var x=G.responseXML;var Q=Ext.DomQuery;var y=Q.select("column",x);this.cols=new Ext.util.MixedCollection();var j=[];var r=0;for(var U=0;U<y.length;U++){var k=y[U];var aa="string";var C=Q.selectValue("@categorized",k,false);var h=(C)?true:false;this.isCategorized=this.isCategorized||h;if(U==0&&this.isCategorized&&(typeof this.category==="string")){continue}var V=r;var p=Q.selectValue("@itemname",k,"columnnumber_"+V);p=p.replace(/^$/,"_");var z=this.visibleCols.contains(p);if(!z){continue}r++;var F=Q.selectValue("columnheader/@title",k,"&nbsp;");var a=Math.max(Q.selectNumber("@width",k)*11.28,22);var v=Q.selectValue("@totals",k,"none");aa=(v!=="none")?"float":aa;var f=Q.selectValue("@responsesonly",k,false);var I=(f)?true:false;var w=Q.selectValue("@twisties",k,false);var n=(w)?true:false;var H=Q.selectValue("@listseparator",k,"none");var t=Q.selectValue("@resizable",k,false);var Y=(t)?true:false;var g=Q.selectValue("@resort",k,false);var u=(g=="ascending"||g=="both")?true:false;var s=(g=="descending"||g=="both")?true:false;var b=(g=="toview")?true:false;var J=(b)?Q.selectValue("@resorttoview",k,""):"";var R=(this.storeConfig.remoteSort===false)?true:(u||s)?true:false;var o=Q.selectValue("@showasicons",k,false);var d=(o)?true:false;var S=Q.selectValue("@align",k,false);var X=(S)?S:"left";var m=Q.selectValue("columnheader/@align",k,false);var c=(m)?m:"left";var W=Q.select("datetimeformat",k)[0];var O={};if(W){aa="date";O.show=Q.selectValue("@show",W);O.date=Q.selectValue("@date",W);O.time=Q.selectValue("@time",W);O.zone=Q.selectValue("@zone",W)}var N=Q.select("numberformat",k)[0];var A={};if(N){aa="float";A.format=Q.selectValue("@format",N);var M=Q.selectValue("@digits",N);A.digits=(M!="varying")?parseInt(M,10):"varying";var Z=Q.selectValue("@parens",N);A.parens=(Z=="true")?true:false;var D=Q.selectValue("@percent",N);A.percent=(D=="true")?true:false;var l=Q.selectValue("@punctuated",N);A.punctuated=(l=="true")?true:false}var e={id:V,header:(b)?F+'<img src="/icons/viewsort.gif" />':F,align:X,dataIndex:p,width:a,totals:v,sortable:R,resortascending:u,resortdescending:s,resortviewunid:J,sortcategorize:h,resize:Y,listseparator:H,response:I,twistie:n,icon:d,datetimeformat:O,numberformat:A};var P={name:p,mapping:V,type:aa};j.push(P);this.cols.add(p,e)}var K=Q.select("view",x);this.isView=(K.length>0)?true:false;this.isFolder=!this.isView;var B=(this.isView)?"view":"folder";if(!this.autoExpandColumn){if(this.extendLastColumn===false){this.autoExpandColumn=false}else{if(this.extendLastColumn===true){this.autoExpandColumn=r-1}else{var E=Q.selectValue(B+"/@extendlastcolumn",x,false);this.extendLastColumn=(E=="true")?true:false;this.autoExpandColumn=(this.extendLastColumn)?r-1:false}}}var T=Q.selectValue(B+"/@allowdocselection",x,false);this.allowDocSelection=(T=="true")?true:false;var aa=Q.selectValue(B+"/@type",x,"view");this.isCalendar=this.isCalendar||(aa=="calendar"?true:false);this.dominoView={meta:{root:"viewentries",record:"viewentry",totalRecords:"@toplevelentries",id:"@position",columnConfig:this.cols,isCategorized:this.isCategorized,fromViewDesign:true},recordConfig:j};this.ViewEntryRecord=Ext.data.Record.create(this.dominoView.recordConfig);this.viewEntryReader=new Ext.nd.data.ViewXmlReader(this.dominoView.meta,this.ViewEntryRecord);this.setStore();if(this.scope){this.callback.createDelegate(this.scope)()}else{this.callback()}},setStore:function(){this.store=new Ext.nd.data[(this.isCategorized&&this.multiExpand)?"CategorizedStore":"ViewStore"](Ext.apply({dbPath:this.dbPath,viewName:this.viewName,viewUrl:this.viewUrl,baseParams:this.baseParams,removeCategoryTotal:this.removeCategoryTotal,reader:this.viewEntryReader,remoteSort:true},this.storeConfig))},getViewDesignFailure:function(a,b){this.fireEvent("getdesignfailure",this,a,b)}});Ext.nd.data.ViewStore=function(a){a=Ext.nd.util.cleanUpConfig(a);this.proxy=new Ext.data.HttpProxy({url:a.viewUrl+"?ReadViewEntries",method:"GET"});Ext.apply(a,{paramNames:{start:"start",limit:"count",sort:"sort",dir:"dir"}});this.removeCategoryTotal=true;Ext.nd.data.ViewStore.superclass.constructor.call(this,a);if(this.category&&typeof this.category=="string"){this.baseParams.RestrictToCategory=this.category}};Ext.extend(Ext.nd.data.ViewStore,Ext.data.Store,{load:function(c){c=c||{};if(this.fireEvent("beforeload",this,c)!==false){this.storeOptions(c);c.params=(c.params)?c.params:{};if(c.params.expand||c.params.expandview){if(this.baseParams.collapse){delete this.baseParams.collapse}if(this.baseParams.collapseview){delete this.baseParams.collapseview}}if(c.params.collapse||c.params.collapseview){if(this.baseParams.expand){delete this.baseParams.expand}if(this.baseParams.expandview){delete this.baseParams.expandview}}var e=Ext.apply(this.baseParams,c.params||{});if(this.sortInfo&&this.remoteSort){var b=this.paramNames;var d=this.fields.get(this.sortInfo.field);var g=d.mapping;var h=this.reader.meta.columnConfig.items[g];if(h.resortviewunid!=""){return}var a=this.sortInfo.direction;if(a=="ASC"){if(typeof e.resortascending!="undefined"){if(e.resortascending!=g){e.resortascending=g;if(e.start){delete e.start;delete e.startkey}delete e.resortdescending}else{if(e.start){delete e.startkey}}}else{e.resortascending=g;delete e.start;delete e.startkey;delete e.resortdescending}}else{if(typeof e.resortdescending!="undefined"){if(e.resortdescending!=g){e.resortdescending=g;if(e.start){delete e.start;delete e.startkey}delete e.resortdescending}else{if(e.start){delete e.startkey}}}else{e.resortdescending=g;delete e.start;delete e.startkey;delete e.resortascending}}}this.proxy.doRequest("read",null,e,this.reader,this.loadRecords,this,c)}},loadRecords:function(e,b,d){var c,a;if(this.removeCategoryTotal){a=e.records.length;if(a>0){c=e.records[a-1];if(c.isCategoryTotal){e.records.pop()}}}Ext.nd.data.ViewStore.superclass.loadRecords.call(this,e,b,d)},sort:function(c,a){var b=this.fields.get(c);if(!b){return false}if(!a){if(this.sortInfo&&this.sortInfo.field==b.name){a=(this.sortToggle[b.name]||"ASC").toggle("ASC","DESC")}else{a=b.sortDir}}this.sortToggle[b.name]=a;this.sortInfo={field:b.name,direction:a};if(!this.remoteSort){this.applySort();this.fireEvent("datachanged",this)}else{this.load(this.lastOptions)}}});Ext.nd.data.ViewXmlReader=function(a,b){if(arguments.length==1&&Ext.isArray(arguments[0])){b=arguments[0];a={}}a=Ext.apply({root:"viewentries",record:"viewentry",totalRecords:"@toplevelentries",id:"@position",fromViewDesign:false},a);Ext.nd.data.ViewXmlReader.superclass.constructor.call(this,a,b||a.fields)};Ext.extend(Ext.nd.data.ViewXmlReader,Ext.data.XmlReader,{readRecords:function(A){this.xmlData=A;var r=A.documentElement||A;var l=Ext.DomQuery;var b=this.recordType,o=b.prototype.fields;var d=this.meta.id;var h=0;if(this.meta.totalRecords){h=l.selectNumber(this.meta.totalRecords,r,0)}var u=[];var B=l.select(this.meta.record,r);for(var t=0,w=B.length;t<w;t++){var p=B[t];var a={};var g={};var m=d?l.selectValue(d,p):undefined;var z;for(var s=0,k=o.length;s<k;s++){var x=o.items[s];if(this.meta.fromViewDesign){z=(typeof x.name=="undefined"||x.name=="")?x.mapping:x.name}else{z=(x.mapping)?x.mapping:x.name}var y=this.getViewColumnValue(p,z,x.defaultValue);var e=y.data;delete y.data;g[x.name]=y;e=x.convert(e);a[x.name]=e}var c=new b(a,m);c.node=p;c.metadata=g;u[u.length]=c;c.hasChildren=p.attributes.getNamedItem("children");c.isResponse=p.attributes.getNamedItem("response");c.position=p.attributes.getNamedItem("position").value;c.depth=c.position.split(".").length;c.noteid=p.attributes.getNamedItem("noteid").value;c.unid=(p.attributes.getNamedItem("unid"))?p.attributes.getNamedItem("unid").value:null;c.isCategory=(c.hasChildren&&!p.attributes.getNamedItem("unid"))?true:false;c.isCategoryTotal=p.attributes.getNamedItem("categorytotal")}return{records:u,totalRecords:h||u.length}},getViewColumnValue:function(d,a,i){var b=Ext.DomQuery;var h;var e;var g,c,j;var f={type:"text",data:""};if(typeof a=="number"){g="entrydata[columnnumber="+a+"]";c=b.select(g,d,false)}else{g="entrydata[name="+a+"]";c=b.select(g,d,false);if(!c){a=a.replace(/^_/,"$");g="entrydata[name="+a+"]";c=b.select(g,d,false)}}j=(c&&c[0])?c[0].lastChild:false;if(j){f=this.getValue(j,j.nodeName);f.category=(b.selectValue("@category",c)=="true")?true:false;f.indent=(b.select("@indent",c))?b.selectNumber("@indent",c):0}return f},getValue:function(d,c){var a={type:c,data:""};if(!d){a.data=""}else{if(d.childNodes&&d.childNodes.length>0&&d.childNodes[0].hasChildNodes()){for(var b=0;b<d.childNodes.length;b++){if(d.childNodes[b].firstChild.nodeName!="#text"){a.type=d.childNodes[b].firstChild.nodeName}else{a.type=c}if(b==0){a.data=d.childNodes[b].firstChild.nodeValue}else{a.data+="\n"+d.childNodes[b].firstChild.nodeValue}}}else{a.type=c;if(d.childNodes&&d.childNodes.length>0){a.data=d.childNodes[0].nodeValue}}}return a}});Ext.nd.data.CategorizedStore=function(a){Ext.nd.data.CategorizedStore.superclass.constructor.call(this,a);this.addEvents("categoryload")};Ext.extend(Ext.nd.data.CategorizedStore,Ext.nd.data.ViewStore,{loadCategory:function(a,b){var c=this.findRecordByPosition(a);if(!c.isCategory||c.childrenRendered){return}this.proxy.doRequest("read",null,{start:a,expand:a,count:60},this.reader,this.loadCategoryRecords,this,Ext.apply({rec:c},b))},loadCategoryRecords:function(g,b,f){if(!g||f===false||!b){if(f!==false){this.fireEvent("categoryload",this,[],b)}if(b.callback){b.callback.call(b.scope||this,[],b,false)}return}var d=g.records;var e=[];if(b.rec){for(var c=0,a=d.length;c<a;c++){var h=b.rec.position+".";if(d[c].position.match(h)){e.push(d[c])}}b.rec.children=e;b.rec.childrenRendered=true;this.fireEvent("datachanged",this)}this.fireEvent("categoryload",this,d,b);if(b.callback){b.callback.call(b.scope||this,d,b,true)}},findRecordByPosition:function(position){var pos=position.split(".");var rec=this.getAt(pos[0]-1);pos.shift();if(pos.length>0){for(var i=0;i<pos.length;i++){pos[i]--}var bleh="rec.children["+pos.join("].children[")+"]";rec=eval(bleh)}return rec},findRecordByIndex:function(b){var a=this.flatRecords();return a[b]},flatRecords:function(){var b=[];for(var a=0;a<this.data.length;a++){b=b.concat(this.findChildren(this.data.items[a]))}return b},findChildren:function(c){var a=[c];if(c&&c.children){for(var b=0;b<c.children.length;b++){a=a.concat(this.findChildren(c.children[b]))}}return a},getCount:function(){var a=0;for(var b=0;b<this.data.length;b++){a+=this.countChildRecords(this.data.items[b])}return a},countChildRecords:function(c){if(c&&c.children){var a=1;for(var b=0;b<c.children.length;b++){a+=this.countChildRecords(c.children[b])}return a}else{return 1}}});Ext.nd.CategorizedRowSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,{selectRow:function(b,d,a){console.log(["here",b,d,a]);if(this.locked||(b<0||b>=this.grid.store.getCount())){return}var c=this.grid.store.findRecordByIndex(b);if(c&&this.fireEvent("beforerowselect",this,b,d,c)!==false){if(!d||this.singleSelect){this.clearSelections()}this.selections.add(c);this.last=this.lastActive=b;if(!a){this.grid.getView().onRowSelect(b)}this.fireEvent("rowselect",this,b,c);this.fireEvent("selectionchange",this)}}});Ext.nd.CategorizedView=Ext.extend(Ext.grid.GridView,{initTemplates:function(){Ext.nd.CategorizedView.superclass.initTemplates.call(this);this.state={};this.selections=[];if(!this.startGroup){this.startGroup=new Ext.XTemplate('<div id="{position}" class="xnd-category {cls}">','<div id="{position}-hd" class="xnd-category-hd" style="{cstyle}"><div>{row}</div></div>','<div id="{position}-bd" class="xnd-category-body" style="{style}">')}this.startGroup.compile();this.endGroup="</div></div>";this.templates.row=new Ext.Template('<div id="{position}" class="x-grid3-row {alt}" style="{tstyle}"><table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table></div>")},renderUI:function(){Ext.nd.CategorizedView.superclass.renderUI.call(this);this.mainBody.on("mousedown",this.interceptMouse,this)},toggleCategory:function(c,b){c=Ext.getDom(c);var a=Ext.fly(c);b=b!==undefined?b:a.hasClass("xnd-category-collapsed");this.state[a.dom.id]=b;if(b){this.grid.getStore().loadCategory(a.dom.id);a.removeClass("xnd-category-collapsed")}else{a.addClass("xnd-category-collapsed")}},interceptMouse:function(g){var d=g.getTarget(".xnd-category-hd",this.mainBody);if(d){g.stopEvent();this.toggleCategory(d.parentNode);var a=this.grid.getSelectionModel();a.clearSelections()}else{return;var k=g.getTarget("div.x-grid3-row");if(k){var h=this.grid.getStore();var b=h.findRecordByPosition(k.id);var a=this.grid.getSelectionModel();a.clearSelections();for(var c=0,f=this.selections.length;c<f;c++){var j=this.selections[c];this.fly(j).removeClass("x-grid3-row-selected");delete j}a.selections.add(b);this.selections.push(k);this.fly(k).radioClass("x-grid3-row-selected")}}},doRender:function(k,e,d,n,m,o){if(e.length<1){return""}var h="width:"+this.getTotalWidth()+";";var c=[];for(var g=0,j=e.length;g<j;g++){var l=n+g;var a=e[g];if(a.isCategory){var f=typeof this.state[a.position]!=="undefined"?!this.state[a.position]:true;var b=f?"xnd-category-collapsed":"";var p=this.oldRender(k,[a],d,l,m,o);c.push(this.startGroup.apply({position:a.position,row:p,cls:b,cstyle:h}));if(a.children){c.push(this.doRender(k,a.children,d,l,m,o))}c.push(this.endGroup)}else{c.push(this.oldRender(k,[a],d,n,m,o))}}return c.join("")},oldRender:function(f,h,q,a,o,v){var b=this.templates,e=b.cell,g=b.row,k=o-1;var d="width:"+this.getTotalWidth()+";";var y=[],s,z,t={},l={tstyle:d},n;for(var u=0,x=h.length;u<x;u++){n=h[u];s=[];var m=(u+a);for(var w=0;w<o;w++){z=f[w];t.id=z.id;t.css=w==0?"x-grid3-cell-first ":(w==k?"x-grid3-cell-last ":"");if(n.isCategory&&(n.depth-1)==w){t.css+="xnd-category-cell"}t.attr=t.cellAttr="";t.value=z.renderer(n.data[z.name],t,n,m,w,q);t.style=z.style;if(t.value==undefined||t.value===""){t.value="&#160;"}if(n.dirty&&typeof n.modified[z.name]!=="undefined"){t.css+=" x-grid3-dirty-cell"}s[s.length]=e.apply(t)}var A=[];if(v&&((m+1)%2==0)){A[0]="x-grid3-row-alt"}if(n.dirty){A[1]=" x-grid3-dirty-row"}l.cols=o;if(this.getRowClass){A[2]=this.getRowClass(n,m,l,q)}l.position=n.position;l.alt=A.join(" ");l.cells=s.join("");y[y.length]=g.apply(l)}return y.join("")},focusRow:function(){},getRows:function(){if(this.hasRows()){var a=Ext.query("div.x-grid3-row",this.mainBody.dom);return a||[]}},onRowSelect:function(a){this.addRowClass(a,"x-grid3-row-selected")}});Ext.namespace("Ext.nd.form");Ext.nd.form.ViewSuggest=function(b,a){this.el=b;this.agentUrl="Suggest?OpenAgent";this.unique=true;Ext.apply(this,a);this.init()};Ext.nd.form.ViewSuggest.prototype={init:function(){if(!this.url){var b=Ext.nd.Session;var a=b.currentDatabase;this.url=Ext.nd.extndUrl+this.agentUrl;this.db=a.filePath}if(!this.view||!this.field){Ext.Msg.alert("ViewSuggest Error","Required parameter (view or fieldname) was omitted from Ext.nd.form.ViewSuggest");return}if(this.extraFields){if(this.unique){Ext.Msg.alert("ViewSuggest Error","You cannot use extra fields when unique is set!");return}this.flds=[this.field].push(this.extraFields)}else{this.flds=[this.field]}this.unique=this.unique?1:0;this.baseParams={view:this.view,fields:this.flds,unique:this.unique};if(this.db){this.baseParams.db=this.db}this.store=new Ext.data.Store(Ext.apply({proxy:new Ext.data.HttpProxy({url:this.url}),reader:new Ext.data.JsonReader({root:"root"},this.flds),baseParams:Ext.apply(this.baseParams,this.extraParams),remoteSort:false},this.storeConfig));this.combo=new Ext.form.ComboBox(Ext.apply({store:this.store,displayField:this.field,loadingText:"Loading...",forceSelection:true,mode:"remote",minChars:3,hideTrigger:true,listWidth:200,width:200,applyTo:this.el},this.comboConfig))}};Ext.nd.UIView=function(a){this.storeConfig={};this.viewConfig={};this.selModelConfig={singleSelect:false,checkOnly:true};this.renderers=[];this.targetDefaults={};this.tbarPlugins=[];this.bbarPlugins=[];this.quickSearchConfig={width:200};this.quickSearchKeyStrokes=[];if(a.gridConfig){Ext.applyIf(a,a.gridConfig);delete a.gridConfig}a=Ext.nd.util.cleanUpUIViewConfig(a);a.columns=[{dataIndex:"dummy",header:""}];this.dmyId="xnd-dummy-store-"+Ext.id();a.store=new Ext.data.Store({id:this.dmyId});Ext.nd.UIView.superclass.constructor.call(this,a)};Ext.extend(Ext.nd.UIView,Ext.grid.GridPanel,{showActionbar:true,showPagingToolbar:true,showSearch:true,showSearchPosition:"bottom",showCategoryComboBox:false,showCategoryComboBoxPosition:"top",buildActionBarFromDXL:true,editMode:true,multiExpand:false,multiExpandCount:40,notCategorizedText:"(Not Categorized)",loadInitialData:true,layout:"fit",documentWindowTitle:"",documentLoadingWindowTitle:"Opening...",documentUntitledWindowTitle:"(Untitled)",documentWindowTitleMaxLength:16,useDocumentWindowTitle:true,extendLastColumn:undefined,enableDragDrop:true,ddGroup:"TreeDD",loadMask:true,count:40,noteType:"view",initComponent:function(){this.on("render",this.getViewDesign,this);this.cols=[];this.recordConfig=[];if(!this.baseParams){this.baseParams={}}if(this.showSingleCategory&&typeof this.showSingleCategory=="string"&&!this.category){this.category=this.showSingleCategory;delete this.showSingleCategory}if(typeof this.category==="string"){this.baseParams.RestrictToCategory=this.category}this.setupSelectionModel();this.setupToolbars();Ext.applyIf(this,{selModel:this.selModel,title:this.viewName,collapseIcon:Ext.nd.extndUrl+"resources/images/minus.gif",expandIcon:Ext.nd.extndUrl+"resources/images/plus.gif",dateTimeFormats:Ext.nd.dateTimeFormats,formatCurrencyFnc:Ext.util.Format.usMoney,tbar:(this.tbar)?this.tbar:null,bbar:(this.showPagingToolbar)?new Ext.nd.PagingToolbar({uiView:this,store:this.store,pageSize:this.count,plugins:this.bbarPlugins}):null});this.addEvents("beforeaddtofolder","beforeclose","beforeopendocument","beforeopen","getdesignfailure","getdesignsuccess","open");this.addEventListeners();Ext.nd.UIView.superclass.initComponent.call(this)},onRender:function(b,a){Ext.nd.UIView.superclass.onRender.call(this,b,a);this.setupButtons()},addEventListeners:function(){this.on("rowdblclick",this.gridHandleRowDblClick,this);this.on("headerclick",this.gridHandleHeaderClick,this,true);this.on("keypress",this.gridHandleKeyDown,this,true);this.on("rowcontextmenu",this.gridHandleRowContextMenu,this,true)},setupToolbars:function(){this.getPlugins();var a="xnd-view-toolbar-"+Ext.id();if(this.tbar){if(Ext.isArray(this.tbar)){this.tbar=new Ext.nd.Actionbar({id:a,noteName:"",uiView:this,target:this.getTarget()||null,items:this.tbar,plugins:this.tbarPlugins})}else{if(this.tbar.add){this.tbar.add(this.tbarPlugins)}this.tbar.uiView=this;this.tbar.id=a}}else{if(this.showActionbar){this.tbar=new Ext.nd.Actionbar({id:a,noteType:this.noteType,dbPath:this.dbPath,noteName:this.viewName,uiView:this,useDxl:this.buildActionBarFromDXL,useViewTitleFromDxl:this.useViewTitleFromDxl,removeEmptyActionbar:this.removeEmptyActionbar,target:this.getTarget()||null,plugins:this.tbarPlugins})}else{if(this.tbarPlugins.length>0){this.tbar=new Ext.nd.Actionbar({id:a,noteName:"",uiView:this,target:this.getTarget()||null,plugins:this.tbarPlugins})}}}},setupButtons:function(){if(this.fbar||this.buttons){if(this.fbar){this.fbar.uiView=this}}},getPlugins:function(){if(this.showCategoryComboBox){var b=new Ext.nd.SingleCategoryCombo({viewUrl:this.viewUrl,value:this.category,count:this.categoryComboBoxCount||-1});if(typeof this.category=="undefined"){this.category=""}if(this.showCategoryComboBoxPosition=="top"){this.tbarPlugins.push(b)}else{this.bbarPlugins.push(b)}}if(this.showSearch){var a=new Ext.nd.SearchPlugin(this);if(this.showSearchPosition=="top"){this.tbarPlugins.push(a)}else{this.bbarPlugins.push(a)}}},setupSelectionModel:function(){if(this.sm){this.selModel=this.sm;delete this.sm}if(!this.selModel){switch(this.selModelConfig.type){case"checkbox":this.selModel=new Ext.grid.CheckboxSelectionModel(this.selModelConfig);this.cols.push(this.selModel);break;case"cell":this.selModel=new Ext.grid.CellSelectionModel(this.selModelConfig);break;case"row":this.selModel=new Ext.grid.RowSelectionModel(this.selModelConfig);break;default:this.selModel=new Ext.grid.RowSelectionModel(this.selModelConfig);break}}},gridHandleRowDblClick:function(a,f,c,b){var d=this.getSelectedDocument(f);if(d&&d.unid){if(this.fireEvent("beforeopendocument",a,f,c,b)!==false){this.openDocument(a,f,c,b)}}},gridHandleCellClick:function(a,l,n,k){var m=Ext.get(k.getTarget());var p,h;var o=false;var g={};var c=a.getStore();var j=c.lastOptions.params.count;j=(typeof j=="undefined")?this.count:j;var f=c.getAt(l);if(m.dom.tagName=="IMG"){p=m.findParent("td.xnd-view-category");o=p;if(!p){h=m.findParent("td.xnd-view-response");o=h}if(o){var b=Ext.get(o);var d=b.hasClass("xnd-view-expand");if(d){g={count:((typeof j!="undefined")&&j!=-1)?l+this.count:j,expand:f.position};c.load({params:g})}else{var i=b.hasClass("xnd-view-collapse");if(i){g={count:(typeof j!="undefined")?j:this.count,collapse:f.position};c.load({params:g})}}}}else{return}},gridHandleKeyDown:function(g){if(g.getTarget().name=="xnd-vw-search"){return}var h=this,b,a,c,l,i,d,f,k=g.browserEvent.keyCode,j=g.charCode;f=g.getTarget();b=h.getSelectionModel();l=b.selections.itemAt(b.selections.length-1);a=h.getStore();i=(l&&l.unid&&a&&a.data)?a.data.findIndex("unid",l.unid):-1;if(g.altKey){return}if(g.ctrlKey&&k==69){h.openDocument(h,i,g,true);return}if(g.ctrlKey){return}if(g.shiftKey&&k==16){return}switch(k){case g.RETURN:h.openDocument(h,i,g);break;case g.DELETE:if(l){h.deleteDocument(h,i,g)}break;case g.BACKSPACE:case g.DOWN:case g.ESC:case g.F5:case g.HOME:case g.LEFT:case g.PAGEDOWN:case g.PAGEUP:case g.RIGHT:case g.UP:case g.TAB:break;case g.SPACE:if(b.isSelected(i)){b.deselectRow(i)}else{b.selectRow(i)}break;default:h.quickSearchKeyStrokes.push(j||k);h.showQuickSearchWindow()}},showQuickSearchWindow:function(a){var b=this;if(!b.quickSearchWindow){b.quickSearchField=new Ext.form.TextField({itemId:"quickSearchInput"});b.quickSearchWindow=new Ext.Window(Ext.apply({border:false,layout:"fit",closeAction:"hide",title:"Starts with...",defaultButton:b.quickSearchField,items:[b.quickSearchField],buttons:[{text:"OK",handler:b.quickSearch,scope:b},{text:"Cancel",scope:b,handler:function(){b.quickSearchWindow.hide()}}],listeners:{show:function(){for(var e=0,c=b.quickSearchKeyStrokes.length;e<c;e++){var d=b.quickSearchKeyStrokes.pop();b.quickSearchField.el.dom.value+=String.fromCharCode(d)}},hide:function(){b.quickSearchField.setValue("")},scope:b}},b.quickSearchConfig))}b.quickSearchWindow.show()},quickSearch:function(a,c){var b=this.getStore(),d=this.quickSearchField.getValue();delete b.lastOptions.params.start;b.load({params:Ext.apply(b.lastOptions.params,{startkey:d})});this.quickSearchWindow.hide()},gridHandleRowContextMenu:function(a,f,c){c.stopEvent();var d=new Ext.menu.Menu({id:"xnd-context-menu"});d.add({editMode:false,text:"Open",handler:this.gridContextMenuOpenDocument,scope:this});d.add({editMode:true,text:"Edit",handler:this.gridContextMenuOpenDocument,scope:this});d.grid=a;d.rowIndex=f;var b=c.getXY();d.showAt([b[0],b[1]])},gridContextMenuSearchView:function(){if(!this.showSearch){Ext.MessageBox.alert("Search View","showSearch must be enabled for the view")}else{Ext.MessageBox.prompt("Search View","Query:",this.handleContextMenuSearch,this)}},handleContextMenuSearch:function(a,b){if(a=="ok"&&b){this.searchField.setValue(b);this.handleViewSearch()}},gridContextMenuOpenDocument:function(b,d){var a=b.parentMenu.grid;var f=b.parentMenu.rowIndex;var c=b.editMode;this.openDocument(a,f,d,c)},gridContextMenuShowDocumentPropertiesDialog:function(){Ext.MessageBox.alert("Document Properties","In a future release, you will see a document properties box.");return},gridDeleteDocumentSuccess:function(a,b){var d=b.row;var c=this.getStore();var f=this.getSelectionModel();var e=c.indexOf(d);if(e==c.data.length){f.selectRow(e)}else{f.selectRow(e+1)}c.remove(d)},gridHandleHeaderClick:function(a,k,f){var c,d;if(!a.region){var i=this.colModel.config[k];if(i.resortviewunid&&i.resortviewunid!=""){f.stopPropagation();var j=this.viewUrl;j=j.substring(0,j.lastIndexOf("/")+1);delete this.viewName;delete a.viewName;delete this.initialConfig.viewName;delete a.initialConfig.viewName;if(a.ownerCt&&a.ownerCt.remove){c={viewUrl:j+i.resortviewunid};Ext.applyIf(c,a.initialConfig);var b=a.ownerCt;var h=b.items.indexOf(a);b.remove(a,true);d=b.insert(h,new Ext.nd.UIView(c));if(d.show){d.show()}b.doLayout()}else{var g=a.container;c=Ext.applyIf({viewUrl:j+i.resortviewunid,renderTo:g},a.initialConfig);a.destroy();d=new Ext.nd.UIView(c);d.on("render",function(){d.doLayout()},this)}return false}else{return true}}else{return true}},editDocument:function(){this.openDocument(this,null,null,true)},openDocument:function(a,h,g,b){if(arguments.length<=1){b=(arguments.length==1)?arguments[0]:false;a=this;h=null;g=null}var j=this.getSelectedDocument(h);var d=(b)?"?EditDocument":"?OpenDocument";if(j==undefined){return}if(!j.unid){return}if(this.fireEvent("beforeopendocument",a,h,g,b)!==false){var c="pnl-"+j.unid;var i=this.viewUrl+"/"+j.unid+d;var f=this.getTarget();if(!f){window.open(i)}else{Ext.nd.util.addIFrame({target:f||this.ownerCt,uiView:this,url:i,id:j.unid})}}},getViewDesign:function(){this.viewDesign=new Ext.nd.data.ViewDesign({dbPath:this.dbPath,viewName:this.viewName,category:this.category,multiExpand:this.multiExpand,storeConfig:this.storeConfig,baseParams:this.baseParams,removeCategoryTotal:false,callback:this.getViewDesignCB,scope:this})},getViewDesignCB:function(d){this.store=this.viewDesign.store;this.isCategorized=this.viewDesign.dominoView.meta.isCategorized;this.isCalendar=this.viewDesign.dominoView.meta.isCalendar;this.allowDocSelection=this.viewDesign.allowDocSelection;this.autoExpandColumn=this.viewDesign.autoExpandColumn;this.isView=this.viewDesign.isView;this.isFolder=this.viewDesign.isFolder;this.ViewEntryRecord=this.viewDesign.ViewEntryRecord;this.viewEntryReader=this.viewDesign.viewEntryReader;if(this.selModelConfig.type==="checkbox"){}else{if(this.allowDocSelection&&(typeof this.selModelConfig.type==="undefined"||(typeof this.selModelConfig.type==="string"&&this.selModelConfig.type!=="checkbox"))){this.un("rowclick",this.selModel.handleDDRowClick,this.selModel);if(this.selModel&&this.selModel.destroy){this.selModel.destroy()}this.selModel=new Ext.grid.CheckboxSelectionModel(this.selModelConfig);this.selModel.init(this);this.on("getdesignsuccess",function(){var f=this.grid.getView();f.mainBody.on("mousedown",this.onMouseDown,this);Ext.fly(f.innerHd).on("mousedown",this.onHdMouseDown,this)},this.selModel);this.cols.length=0;this.cols.push(this.selModel)}}for(var c=0;c<this.viewDesign.cols.items.length;c++){var b=(this.renderers[c])?this.renderers[c]:this.dominoRenderer.createDelegate(this);var a=this.viewDesign.cols.items[c];a.renderer=b;this.cols.push(a)}this.colModel=new Ext.grid.ColumnModel(this.cols);if(this.isCategorized&&this.multiExpand){this.view=new Ext.nd.CategorizedView({});this.enableColumnMove=false;this.view.init(this);this.view.render()}else{this.on("cellclick",this.gridHandleCellClick,this,true)}if(!this.view){this.view=this.getView()}this.reconfigure(this.store,this.colModel);if(this.loadInitialData){this.store.load({params:{count:this.count,start:1}})}if(this.showPagingToolbar){var e=this.getBottomToolbar();if(e){e.isCategorized=this.isCategorized;e.unbind(this.dmyId);e.bind(this.store)}}this.selModel.on("rowselect",function(h,g,f){this.documents=this.getDocuments()},this);this.selModel.on("rowdeselect",function(){this.documents=this.getDocuments()},this);this.fireEvent("getdesignsuccess",this,this.store,this.colModel);this.fireEvent("open",this)},refresh:function(){var a=this.getStore();if(a&&a.proxy){a.reload()}},dominoRenderer:function(u,d,f,q,t,C){if(f.phantom===true){return(typeof u=="undefined")?"":u}if(u==null){return""}if(u&&u.split){u=u.split("\n")}var A="";var p=this.colModel.config[t];var s=f.metadata[p.dataIndex];if(typeof u=="string"&&u==""&&!p.response&&!s.category){return""}var e=arguments;var v=(t>0)?this.colModel.config[t-1]:null;var z=f.node;var j=C.data.items[q+1];var x=(j)?j.node:null;var n=z.attributes.getNamedItem("position").value;var B=n.split(".").length;var o='<img src="'+this.collapseIcon+'" style="vertical-align:bottom; margin-right:8px;"/>';var h='<img src="'+this.expandIcon+'" style="vertical-align:bottom; margin-right:8px;"/>';var a=(20*B)+"px";var k=(20+(20*B))+"px";var c,r,m;if(f.hasChildren&&p.sortcategorize){m=(s.indent)?((s.indent>0)?"padding-left:"+s.indent*20+"px;":""):"";d.attr='style="position: absolute; width: auto; white-space: nowrap; '+m+'"';if(x){c=x.attributes.getNamedItem("position").value;r=c.split(".").length;if(r>B){d.css=" xnd-view-collapse xnd-view-category";A=o+this.getValue(u,p,f)}else{d.css=" xnd-view-expand xnd-view-category";A=h+this.getValue(u,p,f)}}else{d.css=" xnd-view-expand xnd-view-category";A=h+this.getValue(u,p,f)}}else{if(!f.isCategory&&f.hasChildren&&!f.isResponse&&p.response){if(x){c=x.attributes.getNamedItem("position").value;r=c.split(".").length;if(r>B){d.css="xnd-view-collapse xnd-view-response";A=o}else{d.css="xnd-view-expand xnd-view-response";A=h}}else{d.css="xnd-view-expand xnd-view-response";A=h}}else{if(f.hasChildren&&f.isResponse&&p.response){m=(s.indent)?((s.indent>0)?"padding-left:"+(20+(s.indent*20))+"px;":""):"";d.attr='style="position: absolute; width: auto; white-space: nowrap; '+m+'"';if(x){c=x.attributes.getNamedItem("position").value;r=c.split(".").length;if(r>B){d.css="xnd-view-collapse xnd-view-response";A=o+this.getValue(u,p,f)}else{d.css="xnd-view-expand xnd-view-response";A=h+this.getValue(u,p,f)}}else{d.css="xnd-view-expand xnd-view-response";A=h+this.getValue(u,p,f)}}else{if(!f.hasChildren&&f.isResponse&&p.response){d.css="xnd-view-response";m=(s.indent)?((s.indent>0)?"padding-left:"+(20+(s.indent*20))+"px;":""):"";d.attr='style="position: absolute; width: auto; white-space: nowrap; '+m+'"';A=this.getValue(u,p,f)}else{if(p.icon){var y="";var b="";var g=this.getListSeparator(p);var l="";for(var w=0;w<u.length;w++){b=u[w];if(isNaN(parseInt(b,10))||b=="0"){return""}else{newValue=(b<10)?"00"+b:(b<100)?"0"+b:(b>186)?"186":b;l=(p.listseparator=="newline")?'style="clear: left;"':"";y='<div class="xnd-icon-vw xnd-icon-vwicn'+newValue+'" '+l+">&nbsp;</div>";if(w==0){A=y}else{A=A+g+y}}}}else{if(p.totals!="none"){d.css=" xnd-view-totals xnd-view-"+p.totals}A=this.getValue(u,p,f)}}}}}return A},getTarget:function(){if(this.target){return this.target}else{if(window&&window.target){this.target=window.target;return this.target}else{if(this.ownerCt&&this.ownerCt.getXType&&this.ownerCt.getXType()=="tabpanel"){this.target=this.ownerCt.id;return this.target}else{return null}}}},getValue:function(o,p,j){var n,b,e,a,h,m;m=j.metadata[p.dataIndex];h=this.getListSeparator(p);b="";if(p.sortcategorize&&o.length==0){b=this.notCategorizedText}o=(Ext.isArray(o))?o:[""+o];for(var g=0,k=o.length;g<k;g++){var f=p.numberformat;var r=(g+1<k)?h:"";n=m.type;var c=o[g];if(p.icon){if(isNaN(parseInt(c,10))||c==0){return""}else{b=(c<10)?"00"+c:(c<100)?"0"+c:(c>186)?"186":c;return'<img src="/icons/vwicn'+b+'.gif"/>'}}else{if(p.totals=="percentoverall"||p.totals=="percentparent"){return Ext.util.Format.round(100*parseFloat(c),f.digits)+"%"}else{switch(n){case"datetimelist":case"datetime":var q=p.datetimeformat;if(typeof q.show=="undefined"){q.show=this.dateTimeFormats.show}if(c.indexOf("T")>0){e=c.split(",")[0].replace("T",".");a="Ymd.His"}else{e=c;a="Ymd";q.show="date"}var l=Date.parseDate(e,a);switch(q.show){case"date":c=l?l.dateFormat(this.dateTimeFormats.dateFormat):"";break;case"datetime":c=l?l.dateFormat(this.dateTimeFormats.dateTimeFormat):"";break}break;case"textlist":case"text":c=c;break;case"numberlist":case"number":c=parseFloat(c);switch(f.format){case"currency":c=Ext.isEmpty(c)?this.formatCurrencyFnc(0):this.formatCurrencyFnc(c);break;break;case"fixed":case"scientific":if(f.percent){c=Ext.util.Format.round(100*c,f.digits)+"%"}else{c=Ext.util.Format.round(c,f.digits)}break;default:c=c}break;default:c=c}b=b+c+r}}}return b},getListSeparator:function(b){var a="";switch(b.listseparator){case"none":a="";break;case"space":a=" ";break;case"comma":a=",";break;case"newline":a="<br/>";break;case"semicolon":a=";";break;default:a=""}return a},removeFromContainer:function(){if(this.ownerCt&&this.ownerCt.remove){this.ownerCt.remove(this.id)}else{this.destroy()}},getDocuments:function(){return this.getSelectionModel().getSelections()},getSelectedDocument:function(d){var b;if(d){b=this.getStore().getAt(d)}else{var c=this.getSelectionModel();var a=c.selections;b=c.selections.itemAt(a.length-1)}if(b&&b.unid){return b}else{return undefined}},deselectAll:function(){this.getSelectionModel().clearSelections()},expandAll:function(){this.ecAll("expandview")},collapseAll:function(){this.ecAll("collapseview")},ecAll:function(c){var b=this.getStore();var a={};a[c]="true";b.load({params:a})}});Ext.reg("xnd-uiview",Ext.nd.UIView);Ext.nd.SearchPlugin=Ext.extend(Ext.util.Observable,{align:null,iconCls:"icon-magnifier",searchText:"Search",searchCount:40,blankText:"Search view...",searchTipText:"Type a text to search and press Enter",minCharsTipText:"Type at least {0} characters",width:120,shortcutKey:"r",shortcutModifier:"alt",init:function(a){this.toolbar=a;if(this.toolbar.isXType("xnd-actionbar",true)){this.toolbar.on("actionsloaded",this.addSearchField,this)}else{this.toolbar.on("render",this.addSearchField,this)}},addSearchField:function(){this.uiView=this.toolbar.getUIView();if("right"===this.align){this.toolbar.addFill()}else{if(0<this.toolbar.items.getCount()){this.toolbar.addSeparator()}}this.field=new Ext.form.TwinTriggerField({width:this.width,hideTrigger1:true,selectOnFocus:undefined===this.selectOnFocus?true:this.selectOnFocus,trigger1Class:"x-form-clear-trigger",trigger2Class:this.minChars?"x-hidden":"x-form-search-trigger",onTrigger1Click:this.minChars?Ext.emptyFn:this.onTriggerClear.createDelegate(this),onTrigger2Click:this.onTriggerSearch.createDelegate(this),minLength:this.minLength});this.field.on("render",function(){this.field.el.dom.qtip=this.minChars?String.format(this.minCharsTipText,this.minChars):this.searchTipText;if(this.minChars){this.field.el.on({scope:this,buffer:300,keyup:this.onKeyUp})}var c=new Ext.KeyMap(this.field.el,[{key:Ext.EventObject.ENTER,scope:this,fn:this.onTriggerSearch},{key:Ext.EventObject.ESC,scope:this,fn:this.onTriggerClear}]);c.stopEvent=true},this,{single:true});this.toolbar.add(this.searchText);this.toolbar.add(this.field);if(this.shortcutKey&&this.shortcutModifier){var b=this.uiView.getEl();var a=[{key:this.shortcutKey,scope:this,stopEvent:true,fn:function(){this.field.focus()}}];a[0][this.shortcutModifier]=true;this.keymap=new Ext.KeyMap(b,a)}if(true===this.autoFocus){this.uiView.getStore().on({scope:this,load:function(){this.field.focus()}})}},onKeyUp:function(){var a=this.field.getValue().toString().length;if(0===a||this.minChars<=a){this.onTriggerSearch()}},onTriggerClear:function(){if(this.isSearching){var a=this.uiView.getBottomToolbar();if(a){a.unbind(this.uiView.getStore());a.bind(this.oldDataSource)}this.uiView.reconfigure(this.oldDataSource,this.uiView.getColumnModel());this.uiView.getStore().load({params:{start:1}});this.isSearching=false}if(this.field.getValue()){this.field.setValue("");this.field.focus()}this.field.triggers[0].hide()},onTriggerSearch:function(){if(!this.field.isValid()){return}var g=this.field.getValue();var c=this.uiView.getStore();var d=this.uiView.viewUrl.lastIndexOf("/")+1;var a=this.uiView.viewUrl.substring(0,d);var f=this.uiView.viewUrl.substring(d);var h={db:a.substring(0,a.length-1),vw:f};if(!this.isSearching){this.oldDataSource=this.uiView.getStore();if(this.oldDataSource.baseParams.RestrictToCategory){h=Ext.apply(h,{RestrictToCategory:this.oldDataSource.baseParams.RestrictToCategory})}var e=new Ext.nd.data.ViewStore({proxy:new Ext.data.HttpProxy({url:Ext.nd.extndUrl+"SearchView?OpenAgent",method:"GET"}),baseParams:h,reader:this.uiView.viewEntryReader,remoteSort:false});this.uiView.reconfigure(e,this.uiView.getColumnModel());var b=this.uiView.getBottomToolbar();if(b){b.unbind(this.oldDataSource);b.bind(e)}this.isSearching=true}this.uiView.getStore().load({params:{query:g,count:this.searchCount,start:1}});this.field.triggers[0].show()},setDisabled:function(){this.field.setDisabled.apply(this.field,arguments)},enable:function(){this.setDisabled(false)},disable:function(){this.setDisabled(true)}});Ext.reg("xnd-view-search",Ext.nd.SearchPlugin);Ext.nd.SingleCategoryCombo=Ext.extend(Ext.util.Observable,{count:-1,categoryComboBoxEmptyText:"Select a category...",value:"",viewUrl:"",init:function(a){this.toolbar=a;if(this.toolbar.isXType("xnd-actionbar",true)){this.toolbar.on("actionsloaded",this.createCombo,this)}else{this.toolbar.on("render",this.createCombo,this)}this.addEvents("categorychange");this.on("categorychange",this.onCategoryChange,this);if(this.listeners){this.on(this.listeners);delete this.listeners}this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({method:"GET",url:this.toolbar.getUIView().viewUrl+"?ReadViewEntries&CollapseView&count="+this.count}),reader:new Ext.data.XmlReader({record:"viewentry",totalRecords:"@toplevelentries",id:"@position"},[{name:"text"}])});this.store.load()},createCombo:function(){var a="xnd-search-combo-"+Ext.id();this.combo=this.toolbar.add({xtype:"combo",id:a,store:this.store,displayField:"text",typeAhead:true,mode:"local",triggerAction:"all",emptyText:this.categoryComboBoxEmptyText,value:this.value,selectOnFocus:true,grow:true,resizable:true,listeners:{select:this.onComboSelect,scope:this}},"-")},onComboSelect:function(c,a,b){this.fireEvent("categorychange",c,a,b)},onCategoryChange:function(e,a,c){var d=a.data.text;var f=this.toolbar.getUIView();var b=f.getStore();b.baseParams.RestrictToCategory=d;b.load({params:{start:1}})}});Ext.reg("xnd-view-singlecategorycombo",Ext.nd.SingleCategoryCombo);Ext.nd.UIDocument=function(c){c=c||{};var g=this,h=Ext.nd.Session,i=h.currentDatabase,f=Ext.nd.currentUIDocument||{};Ext.apply(g,f);g.document=g.document||{};g.uidoc=f;g.dbPath=i.webFilePath;g.showActionbar=true;g.createActionsFrom="dxl";g.convertFields=true;g.applyDominoKeywordRefresh=true;g.defaultFieldWidth=120;g.documentLoadingWindowTitle="Opening";g.documentUntitledWindowTitle="Untitled";g.useDocumentWindowTitle=true;g.documentWindowTitleMaxLength=16;g.refreshMessage="Refreshing document...";g.toolbarRenderTo;g.dateTimeFormats=Ext.nd.dateTimeFormats;if(typeof g.formName=="undefined"){var d=document.forms,a,j,b,e;if(d.length==0||d[0].name.substring(1)==""||d[0].name.substring(1)=="DominoForm"){a=location.href.toLowerCase();j=location.search.toLowerCase();b=a.indexOf(g.dbPath.toLowerCase())+g.dbPath.length;e=(j!="")?a.indexOf(j):a.length;g.formName=location.href.substring(b,e)}else{g.formName=document.forms[0].name.substring(1)}}if(!g.initialConfig){g.initialConfig={}}Ext.apply(g.initialConfig,c);Ext.apply(g,c);g.formUrl=(g.formUrl)?g.formUrl:g.dbPath+g.formName;Ext.nd.UIDocument.superclass.constructor.apply(g,arguments)};Ext.extend(Ext.nd.UIDocument,Ext.form.FormPanel,{initComponent:function(){var a=this;a.setupToolbars();a.addEvents("beforeclose","beforemodechange","beforeopen","beforesave","open");Ext.nd.UIDocument.superclass.initComponent.call(a);a.setPostUrl();if(Ext.isFunction(_doClick)){_doClick=a._doClick.createDelegate(a)}},_doClick:function(a,g,b,c){var d=this.getForm();if(d.onsubmit){var f=d.onsubmit();if(typeof f=="boolean"&&f==false){return false}}var e=document._domino_target;if(g.href!=null){if(g.target!=null){e=g.target}}else{if(b!=null){e=b}}d.el.dom.target=e;d.findField("__Click").setValue(a);if(c!=null){d.el.dom.action+=c.replace("#","#xnd-goto")}d.el.dom.submit({standardSubmit:true});return false},createForm:function(){delete this.initialConfig.listeners;if(!this.items){this.items={xtype:"label",hidden:true}}return new Ext.form.BasicForm(document.forms[0],this.initialConfig)},render:function(){if(arguments.length==0){new Ext.Viewport({layout:"fit",items:this})}else{Ext.nd.UIDocument.superclass.render.apply(this,arguments)}},onRender:function(b,a){this.body=this.form.el;Ext.nd.UIDocument.superclass.onRender.call(this,b,a);if(this.bodyStyle){this.body.applyStyles(this.bodyStyle)}this.setupButtons()},afterRender:function(){if(this.convertFields){Ext.Ajax.request({method:"GET",disableCaching:true,success:this.doConvertFieldsCB,failure:this.doConvertFieldsCB,arguments:arguments,scope:this,url:Ext.nd.extndUrl+"DXLExporter?OpenAgent&db="+this.dbPath+"&type=form&name="+this.formName});if(Ext.isString(this.layout)){this.layout=new Ext.Container.LAYOUTS[this.layout.toLowerCase()](this.layoutConfig)}this.setLayout(this.layout);Ext.nd.UIDocument.superclass.afterRender.apply(this,arguments)}else{Ext.nd.UIDocument.superclass.afterRender.apply(this,arguments);if(typeof this.layout=="object"){this.doLayout()}this.fireEvent("open",this)}},edit:function(a){var b=this;if(b.fireEvent("beforemodechange",b)!==false){b.onEdit(a)}},onEdit:function(c){var d=this,e=d.getUIView(),b=(e)?e.viewName:"0",a=d.document.universalID;location.href=d.dbPath+b+"/"+a+"?EditDocument"},save:function(a){var b=this;if(b.fireEvent("beforesave",b)!==false){b.onSave(a)}},onSave:function(b){var c=this.getForm(),d;b=(typeof b=="undefined")?{closeOnSave:false}:(typeof b=="boolean")?{closeOnSave:b}:b;d=c.findField("%%ModDate");if(d){d.disable()}var a={};if(b.success){a.success=b.success;delete b.success}if(b.failure){a.failure=b.failure;delete b.failure}if(b.scope){a.scope=b.scope;delete b.scope}c.submit(Ext.apply({method:"POST",success:this.onSaveCallback,failure:this.onSaveCallback,cb:a,scope:this},b))},onSaveCallback:function(f,g){var e=this,d=g.options,c=d.cb,b=g.result,h=b.msg,a=b.unid||b.universalID;if(a){e.setUniversalID(a)}if(b.success){if(c.success){c.success.apply(c.scope||e,arguments)}}else{if(c.failure){c.failure.apply(c.scope||e,arguments)}}},close:function(a){if(this.fireEvent("beforeclose",this)!==false){this.onClose(a)}},onClose:function(a){var d=false;var f=this.getTarget();if(f){switch(f.getXType()){case"window":if(f.closeAction=="close"){f.close();d=true}else{f.hide();d=true}break;case"tabpanel":f.remove(f.getActiveTab());d=true;break;default:if(f.remove){var c=this.getIframeOwnerCt();if(c){f.remove(this.iframeOwnerCt);d=true}else{d=false}}else{d=false}break}}else{if(this.editMode){var e=this.getUIView();var b=(e)?e.viewName:"0";var a=(a)?a:this.document.universalID;if(a){location.href=this.dbPath+b+"/"+a+"?OpenDocument"}else{location.href=this.dbPath}}else{d=false}}return d},setPostUrl:function(){var c=this,f=c.getForm(),e,d,b,a;if(!f.url){e=c.getForm().el.dom.action;if(e==""){d=c.getUIView();b=(d)?d.viewName:"0";a=c.document.universalID;f.url=c.dbPath+b+"/"+a+"?SaveDocument"}else{f.url=e}}},setUniversalID:function(a){var c=this,e=c.getForm(),d=c.getUIView(),b=(d)?d.viewName:"0",a=a||c.document.universalID;e.url=c.dbPath+b+"/"+a+"?SaveDocument";c.document.universalID=a;c.isNewDoc=false},setupToolbars:function(){var a;if(this.tbar){a="xnd-doc-tbar-"+Ext.id();if(Ext.isArray(this.tbar)){this.tbar=new Ext.nd.Actionbar({id:a,noteName:(this.showActionbar)?this.formName:"",uiView:this.getUIView(),uiDocument:this.getUIDocument(),target:this.getTarget()||null,createActionsFrom:this.createActionsFrom,items:this.tbar})}else{this.tbar.id=a;this.tbar.target=this.getTarget()||null;this.tbar.uiDocument=this.getUIDocument();this.tbar.uiView=this.getUIView()}this.dominoActionbar=new Ext.nd.util.DominoActionbar();this.dominoActionbar.hide()}else{if(this.showActionbar){this.tbar=new Ext.nd.Actionbar({id:a,noteType:"form",noteName:this.formName,uiView:this.getUIView(),uiDocument:this.getUIDocument(),target:this.getTarget()||null,createActionsFrom:this.createActionsFrom,renderTo:(this.toolbarRenderTo)?this.toolbarRenderTo:null})}}},setupButtons:function(){if(this.buttons){if(this.fbar){this.fbar.target=this.getTarget()||null;this.fbar.uiDocument=this.getUIDocument();this.fbar.uiView=this.getUIView()}}},doConvertFieldsCB:function(b,c){this.fieldDefinitions=new Ext.util.MixedCollection(false,this.getFieldDefinitionKey);this.fieldDefinitions.addAll(Ext.DomQuery.select("field",b.responseXML));var a=Ext.DomQuery.select("noteinfo",b.responseXML);this.noteinfo={unid:Ext.DomQuery.selectValue("@unid",a),noteid:Ext.DomQuery.selectValue("@noteid",a),sequence:Ext.DomQuery.selectValue("@sequence",a)};this.doConvertFields();this.initFields();Ext.nd.UIDocument.superclass.afterRender.apply(this,c.arguments);this.doLayout();this.fireEvent("open",this)},doConvertFields:function(){var f,d;var g=this.form.el.dom.elements;var e=new Ext.util.MixedCollection();for(var c=0,a=g.length;c<a;c++){d=g[c].id?g[c].id:Ext.id();e.add(d,g[c])}Ext.each(e.items,function(j,h,i){if(!this.convertFromClassName(j,false)){this.convertFromTagName(j)}},this);var b=Ext.DomQuery.select("*[class*=xnd-]");Ext.each(b,function(j,h,i){this.convertFromClassName(j,true)},this)},getFieldDefinition:function(a){if(a.name){return this.fieldDefinitions?this.fieldDefinitions.get(a.name):null}else{return null}},convertFromTagName:function(c){switch(c.tagName){case"BUTTON":break;case"SELECT":var d=this.getFieldDefinition(c);if(d){var f=(Ext.DomQuery.selectValue("@allowmultivalues",d)=="true")?true:false;var e=(Ext.DomQuery.selectValue("keywords/@allownew",d)=="true")?true:false;var a=Ext.DomQuery.selectValue("@choicesdialog",d);if(a=="view"){this.convertToPickList(c,{type:"custom",viewName:Ext.DomQuery.selectValue("@view",d),column:Ext.DomQuery.selectNumber("@viewcolumn",d),multipleSelection:f,allowNew:e})}else{this.convertSelectToComboBox(c,true)}}else{this.convertSelectToComboBox(c,true)}break;case"TEXTAREA":this.convertToTextAreaField(c);break;case"FIELDSET":this.convertToFieldSet(c);break;case"INPUT":var b=c.getAttribute("type");switch(b){case"hidden":this.convertToHiddenField(c);break;case"checkbox":this.convertToCheckbox(c);break;case"radio":this.convertToRadio(c);break;case"file":this.convertToFileUpload(c);break;default:this.convertFromDominoFieldType(c)}break;default:this.convertToTextField(c);break}},convertFromDominoFieldType:function(b){var c=this.getFieldDefinition(b);if(c){var a=Ext.DomQuery.selectValue("@type",c);switch(a){case"password":case"text":this.convertToTextField(b);break;case"datetime":this.convertToDateTimeField(b);break;case"number":this.convertToNumberField(b);break;case"names":this.convertNamesField(b);break;case"keyword":this.convertKeywordField(b);break}}else{this.convertToTextField(b)}},getFieldDefinitionKey:function(a){return Ext.DomQuery.selectValue("@name",a)},convertFromClassName:function(d,e){var b=d.className.split(" ");var f=false;for(var g=0;g<b.length;g++){var a=b[g];switch(a){case"xnd-combobox":if(e){this.convertSelectToComboBox(d,true)}f=true;break;case"xnd-combobox-appendable":if(e){this.convertSelectToComboBox(d,false)}f=true;break;case"xnd-date":if(e){this.convertToDateField(d)}f=true;break;case"xnd-number":if(e){this.convertToNumberField(d)}f=true;break;case"xnd-time":if(e){this.convertToTimeField(d)}f=true;break;case"xnd-htmleditor":if(e){this.convertToHtmlEditor(d)}f=true;break;case"xnd-picklist-names":if(e){this.convertToNamePicker(d)}f=true;break;case"xnd-ignore":f=true;break;default:break}}return f},convertToHiddenField:function(a){this.convertToTextField(a)},convertToTextField:function(a){var b=new Ext.form.TextField({id:(a.id?a.id:a.name),width:this.getFieldWidth(a)});b.applyToMarkup(a);this.form.items.add(b)},convertToFieldSet:function(b){var a=new Ext.form.FieldSet({id:(b.id?b.id:b.name),autoHeight:true,autoWidth:true});a.applyToMarkup(b)},convertNamesField:function(b){var c=this.getFieldDefinition(b);if(c){var e=(Ext.DomQuery.selectValue("@allowmultivalues",c)=="true")?true:false;var d=(Ext.DomQuery.selectValue("keywords/@allownew",c)=="true")?true:false;var a=Ext.DomQuery.selectValue("@choicesdialog",c,false);if(a){switch(a){case"addressbook":this.convertToNamePicker(b,{multipleSelection:e,allowNew:d});break;case"acl":this.convertToACLDialog(b,{multipleSelection:e,allowNew:d});break;case"view":this.convertToPickList(b,{type:"custom",viewName:Ext.DomQuery.selectValue("@view",c),column:Ext.DomQuery.selectNumber("@viewcolumn",c),multipleSelection:e,useCheckboxSelection:true,allowNew:d});break}}else{this.convertToTextField(b)}}},convertToNamePicker:function(c,b){b=b||{};var a=new Ext.nd.form.PickListField(Ext.apply({type:"names",id:(c.id?c.id:c.name),width:this.getFieldWidth(c)},b));a.applyToMarkup(c);this.form.items.add(a)},convertToPickList:function(c,a){var b=new Ext.nd.form.PickListField(Ext.apply({id:(c.id?c.id:c.name),width:this.getFieldWidth(c)},a));b.applyToMarkup(c);this.form.items.add(b)},convertToTextAreaField:function(b){var a=new Ext.form.TextArea({id:(b.id?b.id:b.name),resizable:true});a.applyToMarkup(b);this.form.items.add(a)},convertToFileUpload:function(e){if(Ext.ux.form.FileUploadField){e.id=e.id||Ext.id();var j=e.attributes;var d="";var m="";if(j){var l=j.getNamedItem("style");var b=j.getNamedItem("class");d=l?l.value:"";m=b?b.value:""}var h=e.name;var g=e.id;var k=Ext.DomHelper;var i=Ext.get(e).findParentNode("p",true);if(i){var c=i.innerHTML;k.insertBefore(i,{tag:"div",html:c});Ext.removeNode(i);e=Ext.getDom(g)}var f=k.insertBefore(e,{tag:"div",id:Ext.id()},true);var a=new Ext.ux.form.FileUploadField({id:g,name:h,renderTo:f.id,width:this.getFieldWidth(e)});e.name=Ext.id();Ext.removeNode(e);this.form.items.add(a)}else{this.convertToTextField(e)}},convertToHtmlEditor:function(d){Ext.QuickTips.init();var a=d.tagName.toLowerCase();var c;if(a=="div"){c=new Ext.form.HtmlEditor({id:(d.id?d.id:d.name),renderTo:d})}else{var b=Ext.DomHelper.insertBefore(d,{tag:"div",style:{width:500}},true);b.dom.appendChild(d);Ext.get(d).setStyle({width:510});c=new Ext.form.HtmlEditor();c.applyToMarkup(d);c.on("beforepush",function(h,g){var j="[<div class='xnd-htmleditor-read'>";var f="</div>]";var i=j.length;var e=g.length-f.length;if(g.indexOf(j)==0){g=g.substring(i,e)}h.getEditorBody().innerHTML=g;return false});c.on("beforesync",function(f,e){f.el.dom.value="[<div class='xnd-htmleditor-read'>"+e+"</div>]";return false})}this.form.items.add(c)},convertToNumberField:function(b){var a=new Ext.form.NumberField({width:this.getFieldWidth(b)});a.applyToMarkup(b);this.form.items.add(a)},convertToDateTimeField:function(b){var c=this.getFieldDefinition(b);if(c){var a=Ext.DomQuery.selectValue("datetimeformat/@show",c);switch(a){case"date":this.convertToDateField(b);break;case"time":this.convertToTimeField(b);break}}},convertToDateField:function(a){var b=new Ext.form.DateField({id:(a.id?a.id:a.name),selectOnFocus:true,format:this.dateTimeFormats.dateFormat,width:this.getFieldWidth(a)});b.applyToMarkup(a);this.form.items.add(b)},convertToTimeField:function(b){var a=new Ext.nd.form.TimeField({width:this.getFieldWidth(b)});a.applyToMarkup(b);this.form.items.add(a)},convertToCheckbox:function(d){var e=this.getFieldDefinition(d);var b=this.getDominoGeneratedBoxLabel(d,true);var a=Ext.DomQuery.selectValue("keywords/@columns");var c=new Ext.form.Checkbox({boxLabel:b});c.applyToMarkup(d);this.form.items.add(c)},convertToRadio:function(c){var e=this.getFieldDefinition(c);var b=this.getDominoGeneratedBoxLabel(c,true);var a=Ext.DomQuery.selectValue("keywords/@columns");c.id=Ext.id();var d=new Ext.form.Radio({id:c.id,boxLabel:b});d.applyToMarkup(c);this.form.items.add(d)},getDominoGeneratedBoxLabel:function(e,d){var b="";var c=e.nextSibling;if(c&&c.nodeType==3){b=c.nodeValue;if(d){var a=Ext.get(e).next();if(a!=null&&a.dom.nodeName=="BR"){a.remove()}c.parentNode.removeChild(c)}}return b},convertKeywordField:function(c){var d=this.getFieldDefinition(c);if(d){var g=(Ext.DomQuery.selectValue("@allowmultivalues",d)=="true")?true:false;var f=(Ext.DomQuery.selectValue("keywords/@allownew",d)=="true")?true:false;var a=Ext.DomQuery.selectValue("@choicesdialog",d);if(a=="addressbook"){this.convertToNamePicker(c,{multipleSelection:g,allowNew:f});return}if(a=="acl"){this.convertToACLDialog(c,{multipleSelection:g,allowNew:f});return}if(a=="view"){this.convertToPickList(c,{type:"custom",viewName:Ext.DomQuery.selectValue("@view",d),column:Ext.DomQuery.selectNumber("@viewcolumn",d),multipleSelection:g,allowNew:f});return}var b=Ext.DomQuery.select("keywords/textlist",d);var e=Ext.DomQuery.selectValue("keywords/formula",d,null);if(b.length>0){this.convertToSelectFromTextlist(c,b);return}if(e){this.convertToSelectFromFormula(c,e);return}return}},convertToSelectFromTextlist:function(c,b){var a=new Ext.data.Store({data:b,reader:new Ext.data.XmlReader({record:"text"},[{name:"value",convert:function(e,f){return Ext.DomQuery.selectValue("",f)}}])});var d=new Ext.form.ComboBox({displayField:"value",store:a,typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,width:this.getFieldWidth(c)});d.applyToMarkup(c);this.form.items.add(d)},convertToACLDialog:function(a){},convertToSelectFromFormula:function(d,e){var c=Ext.nd.extndUrl+"Evaluate?OpenAgent";var b=new Ext.data.Store({proxy:new Ext.data.HttpProxy({method:"POST",url:c}),reader:new Ext.data.ArrayReader({},[{name:"value"}]),baseParams:{formula:e,db:this.dbPath,unid:(this.document&&this.document.universalID)?this.document.universalID:"",form:this.formName,outputformat:"json",convertresulttoarray:true}});b.on("load",function(g,f,h){var i=g;var j=f;var k=h});var a=new Ext.form.ComboBox({id:(d.id?d.id:d.name),store:b,typeAhead:true,triggerAction:"all",displayField:"value",valueField:"value",forceSelection:true,resizable:true,width:this.getFieldWidth(d)});a.applyToMarkup(d);this.form.items.add(a)},convertToMultiSelect:function(b,a){},convertToAllowMultiValueSelect:function(b,a){},convertSelectToComboBox:function(el,forceSelection){if(el.parentNode.tagName=="FONT"){var cbContainer=Ext.DomHelper.insertBefore(el.parentNode,{tag:"div"},true);cbContainer.dom.appendChild(el)}var s=Ext.getDom(el);var d=[],opts=s.options;var selectedValue="";var value;for(var i=0,len=opts.length;i<len;i++){var o=opts[i];value=(o.hasAttribute?o.hasAttribute("value"):o.getAttribute("value")!==null)?o.value:o.text;value=(value==""&&o.text!="")?o.text:value;if(o.selected){selectedValue=value}d.push([value,o.text])}var store=new Ext.data.ArrayStore({id:0,fields:["value","text"],data:d,autoDestroy:true});var attr=el.attributes;var style="";var cls="";if(attr){var oStyle=attr.getNamedItem("style");var oCls=attr.getNamedItem("class");style=oStyle?oStyle.value:"";cls=oCls?oCls.value:""}var cb=new Ext.form.ComboBox({transform:el,id:(el.id?el.id:el.name),hiddenName:el.name,store:store,mode:"local",value:selectedValue,valueField:"value",displayField:"text",typeAhead:true,triggerAction:"all",lazyRender:false,forceSelection:forceSelection,resizable:true,style:style,cls:cls,width:this.getFieldWidth(el)});var extcallback=null;if(this.applyDominoKeywordRefresh){var attr=el.attributes;if(attr){var onChange=attr.onchange;if(onChange&&onChange.nodeValue!=null){var sOnChange=onChange.nodeValue;extcallback=function(){if(sOnChange.indexOf("$Refresh")>0){Ext.MessageBox.wait(this.refreshMessage)}eval(sOnChange)};cb.on("select",extcallback,this)}}}this.form.items.add(cb)},getFieldWidth:function(c){var d=Ext.get(c);var a=d.getStyle("width");if(a.indexOf("%",0)>0){return a}else{if(parseFloat(a)==0){return parseFloat(a)}else{var b=d.getComputedWidth();return b==0?this.defaultFieldWidth:b}}},fieldGetText:function(b){var a=this.getForm().findField(b);return(a)?a.getValue():""},fieldSetText:function(b,c){var a=this.getForm().findField(b);if(a){try{a.setValue(c)}catch(d){}}},fieldAppendText:function(b,c){var a=this.getForm().findField(b);if(a){try{a.setValue(a.getValue()+c)}catch(d){}}},fieldClear:function(b){var a=this.getForm().findField(b);if(a){try{a.setValue("")}catch(c){}}},fieldContains:function(c,a){var b=this.getForm().findField(c);var d=false;if(b){try{var g=b.getValue().indexOf(a);d=(g===-1)?false:true}catch(f){}}return d},getTarget:function(){if(this.target){return this.target}else{if(window&&window.target){this.target=window.target;return this.target}else{if(this.ownerCt&&this.ownerCt.getXType&&this.ownerCt.getXType()=="tabpanel"){this.target=this.ownerCt.id;return this.target}else{return null}}}},getIframeOwnerCt:function(){if(this.iframeOwnerCt){return this.iframeOwnerCt}else{if(window&&window.ownerCt){this.iframeOwnerCt=window.ownerCt;return this.iframeOwnerCt}else{return null}}},getUIView:function(){if(this.uiView&&this.uiView!=null){return this.uiView}else{if(window&&window.uiView){this.uiView=window.uiView;return this.uiView}else{return null}}},getUIDocument:function(){return this}});Ext.reg("xnd-uidocument",Ext.nd.UIDocument);Ext.nd.Form=Ext.nd.UIDocument;Ext.nd.Page=Ext.nd.UIDocument;Ext.nd.form.ComboBox=function(a){a=Ext.nd.util.cleanUpConfig(a);Ext.nd.form.ComboBox.superclass.constructor.call(this,a)};Ext.extend(Ext.nd.form.ComboBox,Ext.form.ComboBox,{triggerAction:"all",parentCombo:undefined,queryParam:"startkey",count:40,initComponent:function(){if(this.pageSize){this.count=this.pageSize}else{this.pageSize=this.count}if(this.pageSize===-1){this.pageSize=0}this.on("render",this.getViewDesign,this);Ext.nd.form.ComboBox.superclass.initComponent.call(this)},initList:function(){Ext.nd.form.ComboBox.superclass.initList.call(this);if(this.pageSize){Ext.destroy(this.pageTb);this.pageTb=new Ext.nd.PagingToolbar({beforePageText:"",store:this.store,count:this.count,renderTo:this.footer});this.pageTb.bind(this.store)}},getParams:function(a){var b={};b.start=1;b.count=this.count;return b},getViewDesign:function(){this.viewDesign=new Ext.nd.data.ViewDesign({dbPath:this.dbPath,viewName:this.viewName,viewUrl:this.viewUrl,category:this.category,baseParams:{},queryParam:"startkey",callback:this.getViewDesignCB,scope:this})},getViewDesignCB:function(a){this.store=this.viewDesign.store;if(typeof this.valueField=="number"){this.valueField=this.store.fields.keys[this.valueField]}if(typeof this.displayField=="number"){this.displayField=this.store.fields.keys[this.displayField]}if(typeof this.category=="string"){this.queryParam="restricttocategory"}if(typeof this.parentCombo!="undefined"){this.bindParent();this.disable()}},bindParent:function(){if(typeof this.parentCombo=="string"){this.parentCombo=Ext.getCmp(this.parentCombo)}if(typeof this.parentCombo=="undefined"){alert("parent combo not found")}else{this.parentCombo.on("select",this.onParentSelect,this);this.setEditable(false)}},onParentSelect:function(c,d,b){var a=c.getValue();this.allQuery=a;this.clearValue();if(a==""){this.disable()}else{this.enable()}this.fireEvent("select",this,null,null)}});Ext.reg("xnd-combo",Ext.nd.form.ComboBox);Ext.nd.form.TimeField=Ext.extend(Ext.form.TimeField,{increment:60,selectOnFocus:true,triggerClass:"xnd-form-time-trigger"});Ext.reg("xnd-timefield",Ext.nd.form.TimeField);Ext.nd.Document=function(d){var a="Ext.nd.Document.json";Ext.apply(this,d);var e,c,b;e=location.href;c=e.toLowerCase().indexOf(".nsf/");b=e.substring(0,c+5);this.url=b+"($Ext.nd.SwitchForm)/"+this.unid+"?OpenDocument&form="+a;Ext.Ajax.request({method:"GET",disableCaching:true,success:this.assignValue,failure:this.processException,scope:this,url:this.url})};Ext.nd.Document.prototype={onComplete:function(){},assignValue:function(req){var sTmp,oTmp;sTmp=req.responseText;oTmp=eval("("+sTmp+")");Ext.apply(this,oTmp);this.onComplete()},processException:function(a){Ext.MessageBox.alert("Error","There was an error in the instantiation of the Document class")}};Ext.nd.form.PickListField=function(a){a=Ext.nd.util.cleanUpConfig(a);Ext.nd.form.PickListField.superclass.constructor.call(this,a)};Ext.extend(Ext.nd.form.PickListField,Ext.form.TriggerField,{type:"custom",viewName:"",viewConfig:{},multipleSelection:false,useCheckboxSelection:false,allowNew:false,triggerClass:"xnd-form-picklist-trigger",width:100,pickListWidth:600,column:0,defaultAutoCreate:{tag:"input",type:"text",autocomplete:"off"},category:undefined,showCategoryComboBox:false,categoryComboBoxCount:-1,initComponent:function(){if(this.type=="names"){this.triggerClass="xnd-form-names-trigger"}Ext.nd.form.PickListField.superclass.initComponent.call(this)},applyToMarkup:function(c){if(c.tagName=="SELECT"){var a=Ext.get(c);var b=a.dom.name;a.dom.name=Ext.id();var d=Ext.DomHelper.insertBefore(a,Ext.apply(this.defaultAutoCreate,{name:b}));Ext.removeNode(c);Ext.nd.form.PickListField.superclass.applyToMarkup.call(this,d)}else{Ext.nd.form.PickListField.superclass.applyToMarkup.call(this,c)}},onDestroy:function(){if(this.window){this.window.destroy()}if(this.wrap){this.wrap.remove()}Ext.nd.form.PickListField.superclass.onDestroy.call(this)},onTriggerClick:function(){var a=new Ext.nd.UIWorkspace();a.pickList({type:this.type,width:this.pickListWidth,multipleSelection:this.multipleSelection,useCheckboxSelection:this.useCheckboxSelection,allowNew:this.allowNew,dbPath:this.dbPath,viewName:this.viewName,viewUrl:this.viewUrl,viewConfig:this.viewConfig,column:this.column,category:this.category,showCategoryComboBox:this.showCategoryComboBox,categoryComboBoxCount:this.categoryComboBoxCount,callback:this.processReturnValues.createDelegate(this)})},processReturnValues:function(a){if(a!=null){this.setValue(a.join("; "))}}});Ext.reg("xnd-picklist",Ext.nd.form.PickListField);Ext.nd.form.PickListField.TypeAhead=Ext.extend(Ext.form.TextField,{view:null,queryParam:"startKey",initComponent:function(){this.enableKeyEvents=true;Ext.nd.form.PickListField.TypeAhead.superclass.initComponent.call(this);this.on("keyup",this.onKeyUp,this,{buffer:300})},onKeyUp:function(b){var a={params:{}};a.params[this.queryParam]=this.getValue();this.view.getStore().load(a)}});Ext.reg("xnd-picklist-typeahead",Ext.nd.form.PickListField.TypeAhead);Ext.nd.DominoUI=function(a){Ext.apply(this,a);this.init();this.loadLink()};Ext.nd.DominoUI.prototype={uiView:{viewName:"",viewUrl:""},uiOutline:{outlineName:"",outlineUrl:""},viewOpeningTitle:"Opening...",init:function(){this.createDominoUI()},createDominoUI:function(){var b={region:"west",title:Ext.nd.Session.currentDatabase.title,collapsible:true,split:true,width:200,minSize:150,maxSize:400,layout:"fit",items:[Ext.apply({id:"xnd-outline-panel",xtype:"xnd-uioutline",border:false,target:"xnd-center-panel",viewTarget:"xnd-grid-panel"},this.uiOutline)]};var a={region:"center",id:"xnd-center-panel",xtype:"tabpanel",target:"xnd-center-panel",defaults:{target:"xnd-center-panel",border:true},enableTabScroll:true,activeTab:0,items:[Ext.apply({id:"xnd-grid-panel",layout:"fit",xtype:"xnd-uiview",target:"xnd-center-panel",closable:false},this.uiView)]};this.viewport=new Ext.Viewport({layout:"border",id:"extnd-viewport",items:[b,a]});this.outlinePanel=Ext.getCmp("xnd-outline-panel");this.view=Ext.getCmp("xnd-grid-panel");this.tabPanel=Ext.getCmp("xnd-center-panel")},loadLink:function(){var c=window.location.href;if(c.indexOf("?")>0||c.indexOf("!")>0){var b=(c.indexOf("?")>0)?c.split("?")[1]:c.split("!")[1];var f=Ext.urlDecode(b);var d=f.link;var e=d;if(d){var a=(d.indexOf("?")>0)?c.split("?")[0]:d;Ext.nd.util.addIFrame({target:this.tabPanel,uiView:this.view,url:d,id:a,title:"Opening...",useIFrameTitle:true})}}}};Ext.reg("xnd-dominoui",Ext.nd.DominoUI);Ext.nd.UIOutline=function(a){if(a.treeConfig){Ext.applyIf(a,a.treeConfig);delete a.treeConfig}this.targetDefaults={};this.outlineName="";this.showIcons=true;this.useOutlineIcons=false;this.target=null;this.viewDefaults={};a=Ext.nd.util.cleanUpUIOutlineConfig(a);Ext.apply(this,a);Ext.nd.UIOutline.superclass.constructor.call(this)};Ext.extend(Ext.nd.UIOutline,Ext.tree.TreePanel,{rootVisible:false,animate:true,enableDD:true,ddGroup:"TreeDD",initComponent:function(){Ext.applyIf(this,{id:"xnd-outline-"+Ext.id(),autoScroll:true,containerScroll:true,useEntryTitleAsTargetTitle:true,loader:new Ext.nd.UIOutline.Loader({url:this.outlineUrl+"?ReadEntries"}),dropConfig:{appendOnly:true,notifyDrop:this.addToFolder.createDelegate(this),onNodeOver:this.addToFolderCheck.createDelegate(this)},root:new Ext.nd.TreeNode({text:"outline root",expanded:true,draggable:false,id:"xnd-outline-root"+Ext.id()})});Ext.nd.UIOutline.superclass.initComponent.call(this);this.addEvents("readentries","beforeopenentry","openentry","beforeaddtofolder","addfoldersuccess","addfolderfailure");this.on("click",this.openEntry,this)},afterRender:function(){Ext.nd.UIOutline.superclass.afterRender.call(this);this.getLoader().load(this.getRootNode())},addToFolderCheck:function(h,b,g,f){var d=h.node;var c=d.attributes.extndType;var a=d.attributes.extndUNID;if(d.expand){d.expand()}if(c=="20"){this.isFolder=true;this.dropFolderUNID=a;this.dropFolderName=d.text;return b.dropAllowed}else{this.isFolder=false;this.dropFolderUNID="";return b.dropNotAllowed}},addToFolder:function(a,g,c){var b="";if(this.isFolder){if(this.fireEvent("beforeaddtofolder",this,a,g,c)!==false){if(a.grid){if(a.grid.fireEvent("beforeaddtofolder",a.grid,this.dropFolderName,a,g,c)!==false){var h=g.target;var j="";if(c.selections){var l=c.selections;j=a.grid.viewName;for(var f=0;f<l.length;f++){var k=l[f];b+="unid="+k.unid+"&"}Ext.Ajax.request({method:"POST",disableCaching:true,success:this.addToFolderSuccess,failure:this.addToFolderFailure,scope:this,params:b,extraParams:c,url:Ext.nd.extndUrl+"FolderOperations?OpenAgent&db="+this.filePath+"&operation=putinfolder&folder="+this.dropFolderUNID+"&fromfolder="+j});return true}}}}if(c.node){return true}}return false},addToFolderSuccess:function(a,d){this.fireEvent("addfoldersuccess",this,a,d);var b=d.extraParams.grid;if(b.isFolder){var c=d.extraParams.selections;Ext.each(c,function(e,f,g){b.getStore().remove(e)})}},addToFolderFailure:function(a,b){this.fireEvent("addfolderfailure",this,a,b)},openEntry:function(m,p){if(this.fireEvent("beforeopenentry",this,m)!==false){var j,r,q,o,a,f,c=0,i=m.attributes,n=i.extndHref,b=i.extndType,g=i.extndPosition,t=this.id+"-"+g,s=(this.useEntryTitleAsTargetTitle)?m.text:null;if(b=="2"||b=="20"){r=(this.viewTarget)?this.viewTarget:this.target;q=(this.viewTargetDefaults)?this.viewTargetDefaults:this.targetDefaults}else{r=this.target;q=this.targetDefaults}if(r){r=(r.getXType)?r:Ext.getCmp(r);r=(r&&r.getXType)?r:Ext.get(r)}j=Ext.getCmp(t);if(!j){if(b=="2"||b=="20"){c=1;var h=(n.indexOf("?")>0)?n.split("?")[0]:n.split("!")[0];if(!r){window.open(h+"?OpenView")}else{var l=Ext.apply(Ext.apply({xtype:"xnd-uiview",id:t,layout:"fit",title:s,viewUrl:h},this.viewDefaults),q);if(r.getXType&&r.add){f=r.getXType();switch(f){case"grid":case"xnd-uiview":var d=Ext.state.Manager.get(r.id);if(d){Ext.state.Manager.clear(r.id)}Ext.apply(l,{id:r.id,closable:false});if(r.ownerCt){o=r.ownerCt;var k=o.items.indexOf(r);o.remove(r,true);a=o.insert(k,l)}else{a=r.add(l)}Ext.nd.util.doLayoutAndShow(a);break;default:a=r.add(l);Ext.nd.util.doLayoutAndShow(a);break}}else{Ext.apply(l,{id:t});a=new Ext.nd.UIView(Ext.apply(l,{renderTo:r}));Ext.nd.util.doLayoutAndShow(a)}}}else{if(n!=""){c=2;if(!r){window.open(n)}else{if(r.getXType&&r.add){Ext.nd.util.addIFrame({target:r,url:n,id:t,title:s,useDocumentWindowTitle:false,closable:true,targetDefaults:q})}}}}}else{if(j.show){j.show()}}this.fireEvent("openentry",this,m,c,a)}}});Ext.reg("xnd-uioutline",Ext.nd.UIOutline);Ext.nd.UIOutline.Loader=function(a){Ext.nd.UIOutline.Loader.superclass.constructor.call(this);this.requestMethod="GET";Ext.apply(this,a)};Ext.extend(Ext.nd.UIOutline.Loader,Ext.tree.TreeLoader,{createNode:function(h,o){var m=h.attributes,n,e;var i=m.getNamedItem("type").value;var g=m.getNamedItem("unid")?m.getNamedItem("unid").value:null;var l=m.getNamedItem("title").value;var d=m.getNamedItem("url")?m.getNamedItem("url").value:"";var c=m.getNamedItem("expandable");var k=(c)?true:false;var b=(c&&c.value=="true")?true:false;var j=m.getNamedItem("icon")?m.getNamedItem("icon").value:"";var f=m.getNamedItem("position").value;switch(i){case"0":n=(k)?"folder":"file";break;case"2":n="file";break;case"20":n="folder";break;default:n="file"}e={text:l,cls:(o.showIcons)?n:null,iconCls:(o.showIcons)?((o.useOutlineIcons)?"xnd-icon":null):"xnd-no-icon",allowDrag:(i=="20")?true:false,allowDrop:(i=="20")?true:false,isTarget:true,leaf:false,expanded:b,extndHref:d,extndType:i,extndUNID:g,extndExpandable:c,extndPosition:f,icon:(o.showIcons&&o.useOutlineIcons)?j:null};return new Ext.nd.TreeNode(e)},processResponse:function(f,d,p){var b=f.responseXML;var h=b.getElementsByTagName("outlineentry");try{d.beginUpdate();var a=[];for(var g=0;g<h.length;g++){var m=h.item(g);var c=this.createNode(m,d.getOwnerTree());if(c){var j=m.attributes.getNamedItem("position").value;a[j]=c;if(j.indexOf(".")>0){var l=j.substring(0,j.lastIndexOf("."));a[l].appendChild(c)}else{d.appendChild(c)}}}d.endUpdate();if(typeof p=="function"){p(this,d)}}catch(k){this.handleFailure(f)}}});Ext.nd.TreeNode=Ext.extend(Ext.tree.TreeNode,{hasChildNodes:function(){var a=this.attributes;if(a.extndType=="20"||((a.extndType=="0"||a.extndType=="2")&&(this.attributes.extndExpandable))){return true}else{return false}}});Ext.nd.Actionbar=function(a){this.sess=Ext.nd.Session;this.db=this.sess.currentDatabase;this.dbPath=this.db.webFilePath;this.noteType="";this.noteName="";this.createActionsFrom="dxl";this.dominoActionbar={};this.actions=[];this.useViewTitleFromDxl=false;this.convertFormulas=true;Ext.apply(this,a);Ext.nd.Actionbar.superclass.constructor.call(this);if(!Ext.isEmpty(this.useDxl)&&this.useDxl==false){this.createActionsFrom="document"}this.noteUrl=(this.noteUrl)?this.noteUrl:this.dbPath+this.noteName;if(this.noteName==""){var b=this.noteUrl.lastIndexOf("/")+1;this.dbPath=this.noteUrl.substring(0,b);this.noteName=this.noteUrl.substring(b)}};Ext.extend(Ext.nd.Actionbar,Ext.Toolbar,{init:function(a){this.toolbar=a;if(this.toolbar.getXType()=="xnd-actionbar"){this.toolbar.on("actionsloaded",this.addActions,this)}else{this.addActions()}},initComponent:function(){this.addEvents("actionsloaded");if(!this.isPlugin){Ext.nd.Actionbar.superclass.initComponent.call(this);this.toolbar=this}},onRender:function(b,a){Ext.nd.Actionbar.superclass.onRender.call(this,b,a)},afterRender:function(){if(Ext.isString(this.layout)){this.layout=new Ext.Container.LAYOUTS[this.layout.toLowerCase()](this.layoutConfig)}this.setLayout(this.layout);Ext.nd.Actionbar.superclass.afterRender.apply(this,arguments);this.addActions()},addActions:function(){if(this.noteType==""||this.noteType=="view"){this.dominoActionbar.actionbar=false}else{this.dominoActionbar=new Ext.nd.util.DominoActionbar();this.dominoActionbar.hide()}if(this.createActionsFrom=="document"){this.addActionsFromDocument()}else{if(this.noteName===""){this.fireEvent("actionsloaded",this.toolbar)}else{this.addActionsFromDxl()}}},addActionsFromDxl:function(){Ext.Ajax.request({method:"GET",disableCaching:true,success:this.addActionsFromDxlSuccess,failure:this.addActionsFromDxlFailure,scope:this,url:Ext.nd.extndUrl+"DXLExporter?OpenAgent&db="+this.dbPath+"&type="+this.noteType+"&name="+this.noteName})},addActionsFromDxlSuccess:function(o){var arActions;var q=Ext.DomQuery;var response=o.responseXML;arActions=q.select("action",response);if(this.noteType=="view"&&this.getTarget()&&this.useViewTitleFromDxl){this.setViewName(response)}var curLevelTitle="";var isFirst=false;for(var i=0;i<arActions.length;i++){var show=true;var action=arActions[i];var title=q.selectValue("@title",action,"");var hidewhen=q.selectValue("@hide",action,null);var showinbar=q.selectValue("@showinbar",action,null);var iconOnly=q.select("@onlyiconinbar",action);var icon=q.selectNumber("@icon",action,null);var imageRef=q.selectValue("imageref/@name",action,null);var syscmd=q.selectValue("@systemcommand",action,null);if(hidewhen){var arHide=hidewhen.split(" ");for(var h=0;h<arHide.length;h++){if(arHide[h]=="web"||(typeof Ext.nd.currentUIDocument!="undefined"&&(arHide[h]=="edit"&&Ext.nd.currentUIDocument.editMode)||(arHide[h]=="read"&&!Ext.nd.currentUIDocument.editMode))){show=false}}}if(showinbar=="false"){show=false}var lotusscript=Ext.DomQuery.selectValue("lotusscript",action,null);if(lotusscript){show=false}if(icon){if(icon<10){imageRef="00"+icon}else{if(icon<100){imageRef="0"+icon}else{imageRef=""+icon}}imageRef="/icons/actn"+imageRef+".gif"}else{if(imageRef){imageRef=(imageRef.indexOf("/")==0)?imageRef:this.dbPath+imageRef}}if(show&&syscmd==null){var slashLoc=title.indexOf("\\");var isSubAction;if(slashLoc>0){isSubAction=true;var arLevels=title.split("\\");var iLevels=arLevels.length;var tmpCurLevelTitle=title.substring(0,slashLoc);title=title.substring(slashLoc+1);if(tmpCurLevelTitle!=curLevelTitle){curLevelTitle=tmpCurLevelTitle;isFirst=true}else{isFirst=false}}else{isSubAction=false;curLevelTitle=""}var tmpOnClick=Ext.DomQuery.selectValue("javascript",action,null);var handler=Ext.emptyFn;if(tmpOnClick){var handler=function(){var bleh=tmpOnClick;return function(){return eval(bleh)}}().createDelegate(this)}else{if(this.convertFormulas){var formula=Ext.DomQuery.selectValue("formula",action,null);if(formula){var cmdFrm=formula.match(/\@Command\(\[(\w+)\](?:;"")*(?:;"(.+?)")*\)/);if(cmdFrm&&cmdFrm.length){switch(cmdFrm[1]){case"Compose":handler=this.openForm.createDelegate(this,[cmdFrm[2]]);break;case"EditDocument":handler=this.editDocument.createDelegate(this,[cmdFrm[2]?((cmdFrm[2]=="1")?true:false):true]);break;case"OpenDocument":handler=this.openDocument.createDelegate(this,[cmdFrm[2]?((cmdFrm[2]=="1")?true:false):true]);break;case"FileCloseWindow":handler=this.getUIDocument().close.createDelegate(this.getUIDocument(),[]);break;case"FileSave":handler=this.getUIDocument().save.createDelegate(this.getUIDocument(),[{}]);break;case"EditDeselectAll":handler=this.getUIView().deselectAll.createDelegate(this.getUIView(),[]);break;case"ViewCollapseAll":handler=this.getUIView().collapseAll.createDelegate(this.getUIView(),[]);break;case"ViewExpandAll":handler=this.getUIView().expandAll.createDelegate(this.getUIView(),[]);break;case"FilePrint":case"FilePrintSetup":handler=this.print.createDelegate(this);break;case"OpenView":case"RunAgent":default:show=false}}}}}if(isSubAction){if(isFirst){if(i>0){this.actions.push("-")}this.actions.push({text:curLevelTitle,menu:{items:[{text:title,cls:(icon||imageRef)?"x-btn-text-icon":null,icon:imageRef,handler:handler}]}})}else{this.actions[this.actions.length-1].menu.items.push({text:title,cls:(icon||imageRef)?"x-btn-text-icon":null,icon:imageRef,handler:handler})}}else{if(i>0){this.actions.push("-")}this.actions.push({text:title,cls:(icon||imageRef)?"x-btn-text-icon":null,icon:imageRef,handler:handler})}}}this.processActions();this.removeDominoActionbar();this.fireEvent("actionsloaded",this.toolbar)},addActionsFromDxlFailure:function(a){},addActionsFromDocument:function(o){var arActions=[];var q=Ext.DomQuery;if(this.dominoActionbar.actionbar){arActions=q.select("a",this.dominoActionbar.actionbar)}var curLevelTitle="";var isFirst=false;for(var i=0;i<arActions.length;i++){var action=arActions[i];var title=action.lastChild.nodeValue;var slashLoc=(title)?title.indexOf("\\"):-1;var imageRef=q.selectValue("img/@src",action,null);imageRef=(imageRef==null)?null:(imageRef&&(imageRef.indexOf("/")==0||imageRef.indexOf("http")==0))?imageRef:this.dbPath+imageRef;var cls=(title==null)?"x-btn-icon":(imageRef)?"x-btn-text-icon":null;if(slashLoc>0){isSubAction=true;var arLevels=title.split("\\");var iLevels=arLevels.length;var tmpCurLevelTitle=title.substring(0,slashLoc);title=title.substring(slashLoc+1);if(tmpCurLevelTitle!=curLevelTitle){curLevelTitle=tmpCurLevelTitle;isFirst=true}else{isFirst=false}}else{isSubAction=false;curLevelTitle=""}var handler,sHref,tmpOnClick,oOnClick,arOnClick;sHref=action.getAttribute("href",2);if(sHref!=""){tmpOnClick="location.href = '"+sHref+"';"}else{oOnClick=action.attributes.onclick;if(oOnClick){tmpOnClick=oOnClick.nodeValue}else{tmpOnClick=""}if(tmpOnClick.indexOf("return _doClick")==0){tmpOnClick=tmpOnClick.substring(7)}arOnClick=tmpOnClick.split("\r");var len=arOnClick.length;if(len===1){arOnClick=tmpOnClick.split("\n");len=arOnClick.length}if(arOnClick[len-1]=="return false;"){arOnClick.splice(arOnClick.length-1,1)}tmpOnClick=arOnClick.join(" ")}var handler=function(){var bleh=tmpOnClick;return function(){return eval(bleh)}}().createDelegate(this);if(isSubAction){if(isFirst){if(i>0){this.actions.push("-")}this.actions.push({text:curLevelTitle,menu:{items:[{text:title,cls:cls,icon:imageRef,handler:handler}]}})}else{this.actions[this.actions.length-1].menu.items.push({text:title,cls:cls,icon:imageRef,handler:handler})}}else{if(i>0){this.actions.push("-")}this.actions.push({text:title,cls:cls,icon:imageRef,handler:handler})}}this.processActions();this.removeDominoActionbar();this.fireEvent("actionsloaded",this)},removeDominoActionbar:function(){if(this.dominoActionbar.remove){this.dominoActionbar.remove()}},removeActionbar:function(){this.toolbar.destroy()},syncGridSize:function(){if(this.toolbar.ownerCt){this.toolbar.ownerCt.syncSize();if(this.toolbar.ownerCt.ownerCt){this.toolbar.ownerCt.ownerCt.syncSize()}}},processActions:function(){var a=this.actions.length;if(a>0){Ext.each(this.actions,function(b){this.toolbar.add(b)},this);if(this.createActionsFrom=="dxl"){this.toolbar.doLayout(true,false)}this.syncGridSize()}else{if(this.removeEmptyActionbar){this.removeActionbar()}}},setViewName:function(a){var d=Ext.DomQuery;var b=d.selectValue("view/@name",a);if(typeof b=="undefined"){b=d.selectValue("folder/@name",a)}if(!this.getUIView().showFullCascadeName){var c=b.lastIndexOf("\\");if(c!=-1){b=b.substring(c+1)}}if(this.tabPanel){this.tabPanel.activeTab.setTitle(b)}},openForm:function(i){var g,c,a,h,d,f;if(typeof i=="string"){g=i;c=this.dbPath;a=false;d=this.getTarget()}else{g=i.formName;c=i.dbPath||this.dbPath;a=(i.isResponse)?i.isResponse:false;d=i.target||this.getTarget();f=i.title}h="";if(a){var b=i.parentUNID||this.getParentUNID();var h=(b!=="")?"&parentUNID="+b:""}var e=c+g+"?OpenForm"+h;if(!d){window.open(e)}else{Ext.nd.util.addIFrame({target:d,uiView:this.getUIView(),uiDocument:this.getUIDocument(),url:e,title:f,id:Ext.id()})}},getParentUNID:function(){var a="";if(this.noteType=="view"){var b=this.getUIView().getSelectionModel().getSelected();if(b&&b.unid){a=b.unid}}else{var c=this.getUIDocument();a=(c&&c.document&&c.document.universalID)?c.document.universalID:""}return a},openDocument:function(c){var d=this.getTarget();if(this.noteType=="view"){this.getUIView().openDocument(c);return}if(c){this.getUIDocument().edit()}else{var e=(c)?"?EditDocument":"?OpenDocument";var a=this.getUIDocument().document.universalID;var b=this.dbPath+"0/"+a+e;if(!d){location.href=b}else{Ext.nd.util.addIFrame({target:d,uiView:this.getUIView(),uiDocument:this.getUIDocument(),url:b,id:Ext.id()})}}},editDocument:function(a){if(this.noteType=="view"){this.getUIView().openDocument(a);return}else{this.getUIDocument().edit()}},print:function(){window.print()},unsupportedAtCommand:function(a){Ext.Msg.alert("Error",'Sorry, the @command "'+a+'" is not currently supported by Ext.nd')},getTarget:function(){if(this.target){return this.target}else{if(window&&window.target){this.target=window.target;return this.target}else{if(this.ownerCt&&this.ownerCt.ownerCt&&this.ownerCt.ownerCt.getXType&&this.ownerCt.ownerCt.getXType()=="tabpanel"){this.target=this.ownerCt.ownerCt.id;return this.target}else{return null}}}}});Ext.reg("xnd-actionbar",Ext.nd.Actionbar);Ext.nd.UIWorkspace=function(a){this.sess=Ext.nd.Session;this.db=this.sess.currentDatabase;this.dbPath=this.db.webFilePath;Ext.apply(this,a)};Ext.nd.UIWorkspace.prototype={pickList:function(p){var k,f;var b={type:"custom",multipleSelection:false,dbPath:this.dbPath,viewName:"",title:"PickList",prompt:"Please make your selection(s) and click &lt;OK&gt;.",column:0,width:(p.multipleSelection&&!p.useCheckboxSelection)?600:500,height:400,constrainHeader:true,shadow:true,minWidth:500,minHeight:400,showActionbar:false,showSearch:true,useCheckboxSelection:false,viewConfig:{},category:null,emptyText:"Select a category...",showCategoryComboBox:false,categoryComboBoxCount:-1};Ext.apply(b,p);switch(b.type){case"custom":b.viewUrl=(b.viewUrl)?b.viewUrl:b.dbPath+b.viewName;break;case"names":b.viewUrl=(p.viewName&&p.viewName!=="")?b.dbPath+b.viewName:this.sess.addressBooks[0].webFilePath+"($PeopleGroupsFlat)";b.title=(p.title)?b.title:"Select Name";b.column=(p.column)?b.column:1;break;default:b.viewUrl=(b.viewUrl)?b.viewUrl:b.dbPath+b.viewName}function c(){var q=false;if(b.selections.isXType&&b.selections.isXType("treepanel",true)){var r=e()}else{var r=d()}if(b.callback){q=b.callback}b.dialog.close();if(q){q(r)}else{return r}}var l=function(){var q=false;if(b.callback){q=b.callback}b.dialog.close();if(q){q(null)}else{return null}};var d=function(){var u,t;var s=b.choices.getDocuments();var q=[];for(var r=0;r<s.length;r++){u=(typeof b.column=="string")?b.column:s[r].fields.keys[b.column];t=s[r].data[u];q.push(t)}return q};var e=function(){var u=b.selections;var r=u.getRootNode();var s=r.childNodes;var q=[];for(var t=0;t<s.length;t++){var v=s[t].text;q.push(v)}return q};b.choices=new Ext.nd.UIView(Ext.apply({region:"center",singleSelect:!b.multipleSelection,selModelConfig:(b.multipleSelection&&b.useCheckboxSelection)?{type:"checkbox",singSelect:false}:{},id:"xnd-picklist-view",xtype:"xnd-uiview",header:false,viewUrl:b.viewUrl,category:b.category,showCategoryComboBox:b.showCategoryComboBox,categoryComboBoxCount:b.categoryComboBoxCount,showActionbar:b.showActionbar,showSearch:b.showSearch},b.viewConfig));if(b.type=="names"){var o=[];Ext.each(this.sess.addressBooks,function(s,r,q){o.push(s.filePath)});var h=new Ext.FormPanel({id:"xnd-picklist-prompt",region:"north",frame:true,height:70,labelWidth:150,bodyStyle:{padding:5},items:[{xtype:"combo",fieldLabel:"Choose address book",value:this.sess.addressBooks[0].title,store:o,anchor:"95%"},{xtype:"xnd-picklist-typeahead",view:b.choices,fieldLabel:"Find names starting with",anchor:"95%"}]})}b.selections={};var n={};var j={region:"east",width:0};var i=function(){var s=b.selections;var r=s.getSelectionModel();var q=r.getSelectedNodes();if(q.length>0){q[0].remove()}};var g=function(){var t=b.selections;var q=t.getRootNode();var r=q.childNodes;for(var s=r.length-1;s>=0;s--){r[s].remove()}};var i=function(q,r){if(q.parentNode){q.remove()}};var m=function(){var u,t,r;if(!b.multipleSelection){c();return false}if(b.multipleSelection&&!b.useCheckboxSelection){var s=b.choices.getDocuments();if(s.length>0){for(var q=0;q<s.length;q++){u=(typeof b.column=="string")?b.column:s[q].fields.keys[b.column];t=s[q].data[u];r=new Ext.tree.TreeNode({text:t});b.selections.root.appendChild(r)}b.choices.getSelectionModel().clearSelections()}return false}else{c();return false}};b.choices.on("beforeopendocument",m,this);if(b.multipleSelection&&!b.useCheckboxSelection){var a=((b.height-140)/2)-40;b.selections=new Ext.tree.TreePanel({region:"center",layout:"fit",id:"selections",root:new Ext.tree.TreeNode({text:"Names:",draggable:false,id:"selections-root",expanded:true}),rootVisible:(b.type=="names")?true:false,selModel:new Ext.tree.MultiSelectionModel()});b.selections.on("dblclick",i,this);n={region:"west",width:100,frame:true,border:false,bodyBorder:false,bodyStyle:{paddingTop:a},hideBorders:false,items:[{xtype:"button",minWidth:85,text:"Add &rsaquo;",handler:m,scope:this},{xtype:"button",minWidth:85,text:"&lsaquo; Remove",handler:i},{xtype:"button",minWidth:85,text:"&laquo; Remove All",handler:g}]};j={region:"east",layout:"border",width:(b.width/2),items:[n,b.selections]}}if(!b.dialog){b.dialog=new Ext.Window({id:"xnd-picklist",layout:"border",modal:true,width:b.width,height:b.height,constrainHeader:b.constrainHeader,shadow:b.shadow,minWidth:b.minWidth,minHeight:b.minHeight,title:b.title,items:[(b.type=="names")?h:{region:"north",height:47,xtype:"box",bodyStyle:"padding : 4px;",html:b.prompt,id:"xnd-picklist-prompt"},b.choices,j],buttons:[{text:"OK",handler:c.createDelegate(this)},{text:"Cancel",handler:l.createDelegate(this)}]})}b.dialog.show()},prompt:function(b){var a;var c={};if(typeof arguments[0]=="string"){c.type=arguments[0];c.title=arguments[1];c.prompt=arguments[2];c.callback=(arguments[3])?arguments[3]:false}else{c=b}if(c.type){c.type=c.type.toLowerCase()}else{c.type="ok"}switch(c.type){case"ok":Ext.MessageBox.alert(c.title,c.prompt,c.callback);break;default:Ext.MessageBox.alert("type '"+c.type+"', not yet supported")}},currentDocument:function(){return Ext.nd.currentUIDocument}};Ext.nd.UIWorkspace.prototype.pickListStrings=Ext.nd.UIWorkspace.prototype.pickList;Ext.nd.UIWorkspace.prototype.Prompt=Ext.nd.UIWorkspace.prototype.prompt;Ext.nd.PagingToolbar=function(a){Ext.nd.PagingToolbar.superclass.constructor.call(this,a)};Ext.extend(Ext.nd.PagingToolbar,Ext.PagingToolbar,{beforePageText:"Showing entries ",afterPageText:" - {0}",middlePageText:" of ",paramNames:{start:"start",limit:"count"},initComponent:function(){Ext.nd.PagingToolbar.superclass.initComponent.call(this);Ext.each(this.items.items,function(c,a,b){if(c.getXType&&c.isXType("numberfield",true)){b[a]=this.inputItem=new Ext.form.TextField({cls:"x-tbar-page-number",enableKeyEvents:true,selectOnFocus:true,grow:true,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}})}},this);this.previousCursor=1;this.previousStart=[];this.previousStartMC=new Ext.util.MixedCollection()},readPage:function(b){var a=this.inputItem.getValue();if(!a){this.inputItem.setValue(b.activePage);return false}return a},onPagingKeyDown:function(g,f){var b=f.getKey(),h=this.getPageData(),c;if(b==f.RETURN){f.stopEvent();c=this.readPage(h);this.doLoad(c)}else{if(b==f.HOME||b==f.END){f.stopEvent();c=b==f.HOME?1:h.pages;g.setValue(c)}else{if(b==f.UP||b==f.PAGEUP||b==f.DOWN||b==f.PAGEDOWN){f.stopEvent();if(c==this.readPage(h)){var a=f.shiftKey?10:1;if(b==f.DOWN||b==f.PAGEDOWN){a*=-1}c+=a;if(c>=1&c<=h.pages){g.setValue(c)}}}}}},moveFirst:function(){this.prevButton="first";this.doLoad(1)},movePrevious:function(){this.prevButton="previous";var d;var c=this.store.data.first();var b=c.node.attributes.getNamedItem("position").value;var a=this.previousStartMC.indexOfKey(b);if(a!=-1){if(a==0){d=1}else{d=this.previousStartMC.get(a-1)}}else{if(this.prevButton=="last"){d=this.previousStartMC.last()}else{d=1;this.previousStartMC.clear()}}this.doLoad(d)},moveNext:function(){this.prevButton="next";var d;var b=this.store.data.last();var c=this.store.data.indexOf(b);if(this.store.data.length>0){if(b.isCategoryTotal){var a=this.store.getAt(c-1);d=a.node.attributes.getNamedItem("position").value}else{d=b.node.attributes.getNamedItem("position").value}this.previousStartMC.add(d,d)}else{d=1}this.doLoad(d)},moveLast:function(){this.prevButton="last";var c;var b=this.store.getTotalCount();var a=b%this.pageSize;c=this.isCategorized?b:a?(b-a):b-this.pageSize;this.doLoad(c)},refresh:function(){this.prevButton="refresh";this.doLoad(this.cursor)},onLoad:function(a,c,g){this.cursor=g.params?(g.params.start?g.params.start:1):1;var f=this.getPageData(),b=f.activePage,e=f.pages;if(g.params){if(!g.params.start){f.activePage=1;b=1}}else{f.activePage=1;b=1}this.afterTextItem.setText(String.format(this.afterPageText,f.pages));this.inputItem.setValue(b);this.first.setDisabled(a.baseParams.start==1);this.prev.setDisabled(a.baseParams.start==1);this.next.setDisabled(a.data.length<a.baseParams.count);this.last.setDisabled(a.data.length<a.baseParams.count);this.refresh.enable();this.fireEvent("change",this,f)},getPageData:function(){var d=this.store.getTotalCount();var h,f,a,c,e,b;this.button="";if(this.store.data.length>0){f=this.store.data.first();a=f.node.attributes.getNamedItem("position").value;c=this.store.data.last();if(c.isCategoryTotal){var g=this.store.data.indexOf(c);if(g==0){e=a}else{b=this.store.getAt(g-1);e=b.node.attributes.getNamedItem("position").value}}else{e=c.node.attributes.getNamedItem("position").value}}else{a="1";e="1"}return{total:d,activePage:a,pages:e+this.middlePageText+d}}});Ext.reg("xnd-paging",Ext.nd.PagingToolbar);Ext.nd.util.DominoActionbar=function(){this.actionbar=false;this.actionbarHr=false;this.init()};Ext.nd.util.DominoActionbar.prototype={init:function(){var l=document.forms[0];var a=Ext.DomQuery;var k=l.childNodes;var j,f;var p=false;var o=false;var n=false;var m=false;for(var e=0;e<k.length;e++){var h=k[e];if(h.nodeType==1){if(!p){if(h.tagName=="TABLE"){j=h;var b=a.select("tr",j);if(b.length!=1){break}else{p=true;o=true;continue}}else{if((h.tagName=="INPUT"&&a.selectValue("@type",h,"")=="hidden")||h.tagName=="LABEL"){continue}else{break}}}else{if(h.tagName=="HR"){f=h;n=true}break}}if(p&&o&&n){break}}if(p&&o&&n){var d=a.select("td",j);var g=a.select("a",j);if(d.length==g.length){m=true;this.actionbar=j;this.actionbarHr=f}}},getActionbar:function(){return this.actionbar},getActionbarHr:function(){return this.actionbarHr},hide:function(){if(this.actionbar){Ext.get(this.actionbar).setStyle("display","none");Ext.get(this.actionbarHr).setStyle("display","none")}},remove:function(){if(this.actionbar){Ext.get(this.actionbar).remove();Ext.get(this.actionbarHr).remove()}}};