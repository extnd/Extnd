<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Extnd-app-Application'>/**
</span> * Represents an Extnd application.
 * When creating an MVC app using Ext.application, extend from this class
 * and the Extnd.Session will be created automatically for you.
 *
 * A typical Extnd.app.Application might look like this:
 *
    Ext.application({
        extend      : 'Extnd.app.Application',

        extndUrl    : '/extnd/extnd.nsf/extnd/4x/',
        dbPath      : 'extnd/demo.nsf',
        name        : 'Demo',

        launch: function () {
            Ext.create('Ext.container.Viewport', {
                items: {
                    html: 'My Exntd App'
                }
            });
        }
    });
 *
 *
 */
Ext.define('Extnd.app.Application', {

    extend: 'Ext.app.Application',

    requires: [
        'Extnd.Session'
    ],

<span id='Extnd-app-Application-cfg-dbPath'>    /**
</span>     * @cfg {String} [dbPath]
     * @inheritdoc Extnd#dbPath
     */

<span id='Extnd-app-Application-cfg-extndDbUrl'>    /**
</span>     * @cfg {String} [extndDbUrl]
     * @inheritdoc Extnd#extndDbUrl
     */

<span id='Extnd-app-Application-cfg-extndUrl'>    /**
</span>     * @cfg {String} extndUrl
     * @inheritdoc Extnd#extndUrl
     */

<span id='Extnd-app-Application-cfg-extjsUrl'>    /**
</span>     * @cfg {String} extjsUrl
     * @inheritdoc Extnd#extjsUrl
     */

<span id='Extnd-app-Application-property-session'>    /**
</span>     * @property {Extnd.Session} session
     * @inheritdoc Extnd.Session
     */

<span id='Extnd-app-Application-method-onBeforeLaunch'>    /**
</span>     * Sets some properties on the Extnd singleton used in other classes.
     * Calls #getSession that makes an Ajax call to the Session agent to get Domino Session information.
     * The parent class' onBeforeLaunch method is called later in the callback handlers.
     */
    onBeforeLaunch: function () {
        var me = this,
            parentOnBeforeLaunch;

        // get a reference to the onBeforeLaunch of the parent class
        parentOnBeforeLaunch  = Extnd.app.Application.superclass.onBeforeLaunch;

        // copy some properties to our Extnd singleton
        Extnd.extndDbUrl = me.extndDbUrl = me.extndDbUrl || me.extndUrl;
        Extnd.extndUrl = me.extndUrl || me.extndDbUrl;
        Extnd.extjsUrl = me.extjsUrl || me.extndUrl.replace('extnd', 'extjs');

        // get the Domino Session info
        me.getSession({
            success : parentOnBeforeLaunch,
            failure : parentOnBeforeLaunch,
            scope   : me
        });

    },

<span id='Extnd-app-Application-method-login'>    login: function () {
</span>        console.log('TODO login');
    },

<span id='Extnd-app-Application-method-logout'>    logout: function () {
</span>        console.log('TODO logout');
    },

<span id='Extnd-app-Application-method-getSession'>    /**
</span>     * Gets Domino Session information on the current user.
     * @param {Object} options
     * @param {Function} options.success success handler
     * @param {Function} options.failure failure handler
     * @param {Object} options.scope scope to run the callback handlers under
     */
    getSession: function (config) {
        var me = this;

        // create a new Extnd.Session
        Ext.create('Extnd.Session', {
            extndUrl    : me.extndUrl,
            dbPath      : me.dbPath,
            success     : me.onGetSessionSuccess,
            failure     : me.onGetSessionFailure,
            config      : config,
            scope       : me
        });

    },

<span id='Extnd-app-Application-method-onGetSessionSuccess'>    /**
</span>     * success callback handler for Extnd.Session.
     * Assigns the Domino session info the the #session instance var and calls
     * the onBeforeLaunch method of the parent class.
     * @private
     */
    onGetSessionSuccess: function (session, response, request) {
        var me = this,
            config = request.options.config;

        // decode our response and update in the session instance variable
        me.session = session;

        // now call the callback and pass the session (this) to it
        Ext.callback(config.success, config.scope, arguments);

    },

<span id='Extnd-app-Application-method-onGetSessionFailure'>    /**
</span>     * failure callback handler for Extnd.Session
     * @private
     */
    onGetSessionFailure: function (response) {
        console.log('failed');
    }

});
</pre>
</body>
</html>
