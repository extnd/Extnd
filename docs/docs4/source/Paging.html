<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Extnd-toolbar-Paging'>/**
</span> * A specialized toolbar that is bound to a {@link Ext.nd.data.ViewStore} and provides automatic paging controls geared towards Domino
 */
Ext.define('Extnd.toolbar.Paging', {

    extend  : 'Ext.toolbar.Paging',
    alias   : [
        'widget.xnd-pagingtoolbar',
        'widget.xnd-paging'
    ],

    alternateClassName: [
        'Extnd.PagingToolbar',
        'Ext.nd.toolbar.Paging',
        'Ext.nd.PagingToolbar'
    ],

<span id='Extnd-toolbar-Paging-cfg-beforePageText'>    // change the displayed text
</span>    beforePageText  : 'Showing entries ',
<span id='Extnd-toolbar-Paging-cfg-afterPageText'>    afterPageText   : ' - {0}',
</span><span id='Extnd-toolbar-Paging-property-middlePageText'>    middlePageText  : ' of ',
</span>
<span id='Extnd-toolbar-Paging-method-initComponent'>    initComponent : function () {
</span>        var me = this;

        me.callParent(arguments);

        /* starting with Ext 3rc3 the inputItem was changed from a text field
         * to a number field so we need to change it back so that it will work
         * with Domino's hierarchical start params (i.e. 2.3.2.1, etc.)
         */
        Ext.each(this.items.items, function (item, index, allItems) {
            if (item.getXType &amp;&amp; item.isXType('numberfield', true)) {
                allItems[index] = this.inputItem = new Ext.form.TextField(Ext.apply(item.initialConfig, { grow: true }));
            }
        }, this);

    },

<span id='Extnd-toolbar-Paging-method-onPagingKeyDownzzz'>    // private override since pageNum could represent a deeply nested domino heirarchy (ie 3.22.1.2)
</span>    // and the normal Ext pageNum expects a number
    // TODO need to redo this
    onPagingKeyDownzzz : function (field, e) {

    },

<span id='Extnd-toolbar-Paging-method-moveFirst'>    /**
</span>     * Move to the first page of a Domino view.
     */
    moveFirst : function () {
        var me = this;

        if (me.fireEvent('beforechange', me) !== false) {
            me.store.loadPage('1');
        }
    },

<span id='Extnd-toolbar-Paging-method-movePrevious'>    /**
</span>     * Move to the previous page of a Domino view.
     */
    movePrevious : function () {
        var me = this;

        if (me.fireEvent('beforechange', me) !== false) {
            me.store.previousPage();
        }
    },

<span id='Extnd-toolbar-Paging-method-moveNext'>    /**
</span>     * Move to the next page of a Domino view.
     */
    moveNext : function () {
        var me = this;

        if (me.fireEvent('beforechange', me) !== false) {
            me.store.nextPage();
        }

    },

<span id='Extnd-toolbar-Paging-method-moveLast'>    /**
</span>     * Move to the last page of a Domino view.  This is somewhat tricky since categories
     * and Reader fields on documents make it difficult to calculate where the last page
     * is for a user to see.
     */
    moveLast : function () {
        var me = this,
            start,
            total = me.store.getTotalCount(),
            extra = total % me.store.pageSize;

        start = me.isCategorized ? total : extra ? (total - extra) : total - me.store.pageSize;
        if (me.fireEvent('beforechange', me) !== false) {
            me.store.loadPage(start);
        }
    },

<span id='Extnd-toolbar-Paging-method-onLoad'>    /**
</span>     * Custom Domino version that uses 'start positions' instead of 'pages'.  So all references to currPage
     * have been replaced with currStart and pageCount is not used at all since it is difficult to calculate
     * the 'page count' of a Domino view when you consider categories and Reader fields.
     */
    onLoad : function () {
        var me = this,
            pageData,
            currStart,
            toRecord,
            afterText,
            count,
            isEmpty;

        count = me.store.getCount();
        isEmpty = count === 0;
        if (!isEmpty) {
            pageData = me.getPageData();
            currStart = pageData.currentStart;
            toRecord = pageData.toRecord;
            afterText = Ext.String.format(me.afterPageText, toRecord);
        } else {
            currStart = '1';
            toRecord = '1';
            afterText = Ext.String.format(me.afterPageText, 0);
        }

        Ext.suspendLayouts();
        me.child('#afterTextItem').setText(afterText);
        me.child('#inputItem').setDisabled(isEmpty).setValue(currStart);
        me.child('#first').setDisabled(currStart === '1' || isEmpty);
        me.child('#prev').setDisabled(currStart === '1'  || isEmpty);
        me.child('#next').setDisabled(currStart === toRecord  || isEmpty);
        me.child('#last').setDisabled(currStart === toRecord  || isEmpty);
        me.child('#refresh').enable();
        me.updateInfo();
        Ext.resumeLayouts(true);

        if (me.rendered) {
            me.fireEvent('change', me, pageData);
        }
    },

<span id='Extnd-toolbar-Paging-method-getPageData'>    /**
</span>     * Custom version for Domino that deals with the 'start position' of a view
     * instead of 'pages'.  The fromRecord and toRecord variables are done differently
     * as well since we cannot calculate them like the ExtJS version of the Paging toolbar can.
     */
    getPageData : function () {
        var store       = this.store,
            totalCount  = store.getTotalCount(),
            firstRec    = store.first(),
            lastRec     = store.last();

        return {
            total           : totalCount,
            currentStart    : store.currentStart,
            fromRecord      : firstRec ? firstRec.position : 0,
            toRecord        : lastRec ? lastRec.position : 0
        };
    }

});
</pre>
</body>
</html>
